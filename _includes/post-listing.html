{% for post in posts %}
{% capture this_year %}{{ post.date | date: "%Y" }}{% endcapture %}
{% capture this_month %}{{ post.date | date: "%B" }}{% endcapture %}
{% capture this_month_num %}{{ post.date | date: "%m" }}{% endcapture %}
{% capture next_year %}{{ post.previous.date | date: "%Y" }}{% endcapture %}
{% capture next_month %}{{ post.previous.date | date: "%B" }}{% endcapture %}
{% capture next_month_num %}{{ post.previous.date | date: "%m" }}{% endcapture %}
{% capture tmp_year %}{{ post.date|date:'%Y' }}{% endcapture %}

{% if year != tmp_year %}
{% assign year = tmp_year %}
<h1 class="archives"><a href="/blog/{{this_year}}">{{ year }}</a></h1>
{% endif %}

{% capture tmp_month %}{{ post.date|date:'%B' }}{% endcapture %}
{% if month != tmp_month %}
{% assign month = tmp_month %}
<h2 class="month"><a href="/blog/{{this_year}}/{{this_month_num}}">{{ month }}</a></h2>
{% endif %}
<div class="archive-link">
	<div class="inner">
		<span class="archive-date">{{ post.date|date:'%d' }}</span>
		<a href="{{ post.url }}">{{ post.title }}</a>
		<span class="tag-list hidden-xs">
			{% for tag in post.tags %}
			<a href="/blog/tags/{{ tag | downcase | slugify }}/">{{ tag }}</a>
			{% endfor %}
		</span>
	</div>
</div>

{% endfor %}