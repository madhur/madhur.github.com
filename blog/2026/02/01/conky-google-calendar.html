<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8" /> 
    <title>Displaying Google Calendar Events in Conky &#8211; Madhur Ahuja</title>
    

    <meta name="author" content="Madhur Ahuja" />
    <meta name="description" content=" Displaying Google Calendar Events in Conky" />

    <link rel="start" href="/" />

    <link rel="alternate" type="application/atom+xml" href="http://feeds.feedburner.com/madhur" title="RSS feed" />
    <link rel="shortcut icon" href="http://www.gravatar.com/avatar/5352cde0b084abcd6d4d783c08a51c76?s=16" />

    <link rel="stylesheet" href="/files/css/bootstrap.min.css" type="text/css" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="/files/font-awesome/css/font-awesome.min.css" type="text/css" />
    <script src="/files/js/vendor/fancybox.umd.js" tpye="text/javascript"></script>
    <link rel="stylesheet" href="/files/css/fancybox.css" type="text/css" />

    <link rel="stylesheet" type="text/css" href="/files/css/styles.css" /> 
    <link rel="stylesheet" type="text/css" href="/files/css/syntax.css" /> 

     <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-N14VDHYFHQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-N14VDHYFHQ');
</script> 
    <link rel="stylesheet" type="text/css" media="print" href="/files/css/print.css"> 

    <script src="/files/js/vendor/pace.min.js" type="text/javascript"></script>
</head>


<body>

    <div class="container">

        <header id="header" class="row">

            <nav id="navigation" class="navbar navbar-inverse navbar-fixed-top top-nav-collapse" role="navigation">
    <div class="container">

        <div class="navbar-header">

            <div class="hidden-md hidden-sm hidden-lg searchli">

                <form method="get" role="search" id="searchform" action="/results" onsubmit="return checkfrm_search();">

                    <div class="form-group">
                        <input type="search" required id="q2" name="q" value="" class="form-control mobile"
                            placeholder="Search" />
                    </div>
                </form>
            </div>

            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#mainmenu">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <!--  <a class="navbar-brand " href="/">Home</a> -->
        </div>

        <div class="collapse navbar-collapse" id="mainmenu">
            <ul id="nav" class="nav navbar-nav">

                <li><a class="home" href="/">Home</a>
                </li>
                <li><a class="blog" href="/blog">Blog</a>
                </li>
                <!--<li><a class="work" href="/work">Resume</a></li>-->
                <li><a class="code" href="/projects">Work</a>
                </li>
                <!--<li><a class="papers" href="/papers">Papers</a></li>-->
                <li><a class="info" href="/info">About</a>
                </li>
                <li><a class="contact" href="/contact">Contact</a>
                </li>

            </ul>

            <ul class="nav navbar-nav visible-md visible-lg visible-sm searchbox">
                <li>
                    <form method="get" role="search" id="searchform" action="/results"
                        onsubmit="return checkfrm_search();">

                        <div class="form-group">
                            <input type="search" required id="q1" name="q" value="" class="form-control desktop"
                                placeholder="Search" />
                        </div>
                    </form>
                </li>
            </ul>


            <ul class="nav-icons navbar-right nav navbar-nav visible-md visible-lg">
                <li><a href="http://www.linkedin.com/in/madhurahuja"><i class="fa fa-linkedin-square fa-3x"></i></a>
                </li>
                <li><a href="https://github.com/madhur"><i class="fa fa-github fa-3x"></i></a>
                </li>
                <li><a href="http://feeds.feedburner.com/madhur"><i class="fa fa-rss-square fa-3x"></i></a>
                </li>
            </ul>


        </div>

    </div>
</nav>

        </header>

        <div id="content" class="row">

            <section>

	<div id="blogcontent">


		<article id="blog-article" class="post col-md-12 clearfix">

			<header>
				<h1>Displaying Google Calendar Events in Conky</h1>
			</header>

			



<div class="post-meta">
    <time datetime="2026-02-01T00:00:00+05:30">February 01, 2026</time>
    <span class="reading-time">10 min read</span>
</div>


			<hr style="margin-top:0px" />


			<blockquote>
  <p><strong>Disclaimer</strong>: This blog article has been generated with the assistance of AI. While the content is AI-generated, the software itself and the ideas behind it are the result of real development work and genuine user needs.</p>
</blockquote>

<p><strong>Disclaimer</strong>: This article was generated with assistance from AI and reflects a technical implementation discussion.</p>

<p>Conky is a popular system monitor for Linux desktops, but its capabilities extend beyond displaying CPU usage and memory stats. This guide shows how to integrate Google Calendar events into your Conky display using Python and Google’s Calendar API, with proper support for recurring events.</p>

<h2 id="why-use-the-api-instead-of-ical">Why Use the API Instead of iCal?</h2>

<p>While Google Calendar provides iCal feeds, they have significant limitations for recurring events:</p>

<ul>
  <li>iCal feeds only include expanded instances for a limited time window</li>
  <li>Future recurring events beyond that window aren’t included</li>
  <li>No control over the expansion period</li>
</ul>

<p>The Google Calendar API with <code class="language-plaintext highlighter-rouge">singleEvents=true</code> parameter properly expands recurring events for any specified time range.</p>

<h2 id="prerequisites">Prerequisites</h2>

<ul>
  <li>Python 3.8+</li>
  <li>pipenv (for dependency management)</li>
  <li>A Google Cloud Console account</li>
  <li>Conky installed on your Linux system</li>
</ul>

<h2 id="setup-process">Setup Process</h2>

<h3 id="1-create-service-account">1. Create Service Account</h3>

<p>Navigate to <a href="https://console.cloud.google.com/">Google Cloud Console</a>:</p>

<ol>
  <li>Create or select a project</li>
  <li>Enable the Google Calendar API (APIs &amp; Services → Library)</li>
  <li>Create a Service Account (IAM &amp; Admin → Service Accounts)</li>
  <li>Generate a JSON key file for the service account</li>
  <li>Download and save as <code class="language-plaintext highlighter-rouge">google_calendar_key.json</code></li>
</ol>

<h3 id="2-grant-calendar-access">2. Grant Calendar Access</h3>

<p>The service account needs permission to read your calendar:</p>

<ol>
  <li>Open the JSON file and copy the <code class="language-plaintext highlighter-rouge">client_email</code> value</li>
  <li>In Google Calendar, go to Settings → Your Calendar → Share with specific people</li>
  <li>Add the service account email with “See all event details” permission</li>
</ol>

<h3 id="3-project-structure">3. Project Structure</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> ~/.conky/calendar-project
<span class="nb">cd</span> ~/.conky/calendar-project
</code></pre></div></div>

<p>Create <code class="language-plaintext highlighter-rouge">Pipfile</code>:</p>
<div class="language-toml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nn">[[source]]</span>
<span class="py">url</span> <span class="p">=</span> <span class="s">"https://pypi.org/simple"</span>
<span class="py">verify_ssl</span> <span class="p">=</span> <span class="kc">true</span>
<span class="py">name</span> <span class="p">=</span> <span class="s">"pypi"</span>

<span class="nn">[packages]</span>
<span class="py">python-dotenv</span> <span class="p">=</span> <span class="s">"*"</span>
<span class="py">google-auth</span> <span class="p">=</span> <span class="s">"*"</span>
<span class="py">google-auth-oauthlib</span> <span class="p">=</span> <span class="s">"*"</span>
<span class="py">google-auth-httplib2</span> <span class="p">=</span> <span class="s">"*"</span>
<span class="py">google-api-python-client</span> <span class="p">=</span> <span class="s">"*"</span>

<span class="nn">[dev-packages]</span>

<span class="nn">[requires]</span>
<span class="py">python_version</span> <span class="p">=</span> <span class="s">"3.8"</span>
</code></pre></div></div>

<p>Install dependencies:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pipenv <span class="nb">install</span>
</code></pre></div></div>

<h3 id="4-configuration">4. Configuration</h3>

<p>Create <code class="language-plaintext highlighter-rouge">.env</code> file:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">GOOGLE_SERVICE_ACCOUNT_FILE</span><span class="o">=</span>google_calendar_key.json
<span class="nv">GOOGLE_CALENDAR_ID</span><span class="o">=</span>primary
<span class="nv">MAX_EVENTS</span><span class="o">=</span>10
<span class="nv">CACHE_DAYS</span><span class="o">=</span>7
</code></pre></div></div>

<p>Set secure permissions:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chmod </span>600 .env google_calendar_key.json
</code></pre></div></div>

<h3 id="5-python-script">5. Python Script</h3>

<p>Create <code class="language-plaintext highlighter-rouge">get_calendar.py</code>:</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env python3
</span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">dotenv</span> <span class="kn">import</span> <span class="n">load_dotenv</span>
    <span class="kn">from</span> <span class="nn">google.oauth2</span> <span class="kn">import</span> <span class="n">service_account</span>
    <span class="kn">from</span> <span class="nn">googleapiclient.discovery</span> <span class="kn">import</span> <span class="n">build</span>
    <span class="n">DEPENDENCIES_AVAILABLE</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">except</span> <span class="nb">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">DEPENDENCIES_AVAILABLE</span> <span class="o">=</span> <span class="bp">False</span>
    <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Missing dependencies: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

<span class="c1"># Load configuration
</span><span class="n">script_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">__file__</span><span class="p">).</span><span class="n">parent</span>
<span class="n">env_file</span> <span class="o">=</span> <span class="n">script_dir</span> <span class="o">/</span> <span class="s">'.env'</span>
<span class="k">if</span> <span class="n">env_file</span><span class="p">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="n">load_dotenv</span><span class="p">(</span><span class="n">env_file</span><span class="p">)</span>

<span class="n">SERVICE_ACCOUNT_FILE</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">'GOOGLE_SERVICE_ACCOUNT_FILE'</span><span class="p">,</span> <span class="s">'google_calendar_key.json'</span><span class="p">)</span>
<span class="n">CALENDAR_ID</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">'GOOGLE_CALENDAR_ID'</span><span class="p">,</span> <span class="s">'primary'</span><span class="p">)</span>
<span class="n">MAX_EVENTS</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">'MAX_EVENTS'</span><span class="p">,</span> <span class="s">'10'</span><span class="p">))</span>
<span class="n">CACHE_DAYS</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">os</span><span class="p">.</span><span class="n">getenv</span><span class="p">(</span><span class="s">'CACHE_DAYS'</span><span class="p">,</span> <span class="s">'7'</span><span class="p">))</span>
<span class="n">CACHE_FILE</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s">"~/.conky/calendar_cache.txt"</span><span class="p">)</span>
<span class="n">SCOPES</span> <span class="o">=</span> <span class="p">[</span><span class="s">'https://www.googleapis.com/auth/calendar.readonly'</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">check_internet</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">socket</span><span class="p">.</span><span class="n">create_connection</span><span class="p">((</span><span class="s">"8.8.8.8"</span><span class="p">,</span> <span class="mi">53</span><span class="p">),</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">True</span>
    <span class="k">except</span> <span class="nb">OSError</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">False</span>

<span class="k">def</span> <span class="nf">get_calendar_service</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">script_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">__file__</span><span class="p">).</span><span class="n">parent</span>
        <span class="n">service_account_path</span> <span class="o">=</span> <span class="n">script_dir</span> <span class="o">/</span> <span class="n">SERVICE_ACCOUNT_FILE</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="n">service_account_path</span><span class="p">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="k">raise</span> <span class="nb">FileNotFoundError</span><span class="p">(</span><span class="sa">f</span><span class="s">"Service account file not found: </span><span class="si">{</span><span class="n">service_account_path</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        
        <span class="n">credentials</span> <span class="o">=</span> <span class="n">service_account</span><span class="p">.</span><span class="n">Credentials</span><span class="p">.</span><span class="n">from_service_account_file</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">service_account_path</span><span class="p">),</span> <span class="n">scopes</span><span class="o">=</span><span class="n">SCOPES</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">build</span><span class="p">(</span><span class="s">'calendar'</span><span class="p">,</span> <span class="s">'v3'</span><span class="p">,</span> <span class="n">credentials</span><span class="o">=</span><span class="n">credentials</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Error creating calendar service: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">get_events</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">service</span> <span class="o">=</span> <span class="n">get_calendar_service</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">service</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>
        
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">now</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="n">hour</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">minute</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">second</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">microsecond</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">start_time</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">CACHE_DAYS</span><span class="p">)</span>
        
        <span class="n">time_min</span> <span class="o">=</span> <span class="n">start_time</span><span class="p">.</span><span class="n">isoformat</span><span class="p">()</span> <span class="o">+</span> <span class="s">'Z'</span>
        <span class="n">time_max</span> <span class="o">=</span> <span class="n">end_time</span><span class="p">.</span><span class="n">isoformat</span><span class="p">()</span> <span class="o">+</span> <span class="s">'Z'</span>
        
        <span class="c1"># Key parameter: singleEvents=True expands recurring events
</span>        <span class="n">events_result</span> <span class="o">=</span> <span class="n">service</span><span class="p">.</span><span class="n">events</span><span class="p">().</span><span class="nb">list</span><span class="p">(</span>
            <span class="n">calendarId</span><span class="o">=</span><span class="n">CALENDAR_ID</span><span class="p">,</span>
            <span class="n">timeMin</span><span class="o">=</span><span class="n">time_min</span><span class="p">,</span>
            <span class="n">timeMax</span><span class="o">=</span><span class="n">time_max</span><span class="p">,</span>
            <span class="n">maxResults</span><span class="o">=</span><span class="n">MAX_EVENTS</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
            <span class="n">singleEvents</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>  <span class="c1"># Expands recurring events
</span>            <span class="n">orderBy</span><span class="o">=</span><span class="s">'startTime'</span>
        <span class="p">).</span><span class="n">execute</span><span class="p">()</span>
        
        <span class="n">events</span> <span class="o">=</span> <span class="n">events_result</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'items'</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">return</span> <span class="n">events</span><span class="p">[:</span><span class="n">MAX_EVENTS</span><span class="p">]</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Error fetching events: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">format_event</span><span class="p">(</span><span class="n">event</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="n">event</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'summary'</span><span class="p">,</span> <span class="s">'No Title'</span><span class="p">)</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">event</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'start'</span><span class="p">,</span> <span class="p">{})</span>
        
        <span class="k">if</span> <span class="s">'dateTime'</span> <span class="ow">in</span> <span class="n">start</span><span class="p">:</span>
            <span class="n">dt_str</span> <span class="o">=</span> <span class="n">start</span><span class="p">[</span><span class="s">'dateTime'</span><span class="p">]</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">dt_str</span><span class="p">.</span><span class="n">replace</span><span class="p">(</span><span class="s">'Z'</span><span class="p">,</span> <span class="s">'+00:00'</span><span class="p">)).</span><span class="n">astimezone</span><span class="p">()</span>
            <span class="n">time_str</span> <span class="o">=</span> <span class="n">dt</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">'%m/%d %H:%M'</span> <span class="k">if</span> <span class="n">CACHE_DAYS</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s">'%H:%M'</span><span class="p">)</span>
        <span class="k">elif</span> <span class="s">'date'</span> <span class="ow">in</span> <span class="n">start</span><span class="p">:</span>
            <span class="n">date_obj</span> <span class="o">=</span> <span class="n">datetime</span><span class="p">.</span><span class="n">fromisoformat</span><span class="p">(</span><span class="n">start</span><span class="p">[</span><span class="s">'date'</span><span class="p">])</span>
            <span class="n">time_str</span> <span class="o">=</span> <span class="n">date_obj</span><span class="p">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">'%m/%d All Day'</span> <span class="k">if</span> <span class="n">CACHE_DAYS</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s">'All Day'</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">time_str</span> <span class="o">=</span> <span class="s">'??:??'</span>
        
        <span class="c1"># Truncate long summaries
</span>        <span class="n">max_length</span> <span class="o">=</span> <span class="mi">35</span> <span class="k">if</span> <span class="n">CACHE_DAYS</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">40</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">summary</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">max_length</span><span class="p">:</span>
            <span class="n">summary</span> <span class="o">=</span> <span class="n">summary</span><span class="p">[:</span><span class="n">max_length</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="s">'...'</span>
        
        <span class="c1"># Add recurring indicator
</span>        <span class="k">if</span> <span class="n">event</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="s">'recurringEventId'</span><span class="p">):</span>
            <span class="n">summary</span> <span class="o">+=</span> <span class="s">" ↻"</span>
        
        <span class="k">return</span> <span class="sa">f</span><span class="s">"</span><span class="si">{</span><span class="n">time_str</span><span class="si">}</span><span class="s"> - </span><span class="si">{</span><span class="n">summary</span><span class="si">}</span><span class="s">"</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s">"Error formatting event: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span>

<span class="k">def</span> <span class="nf">load_cache</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">exists</span><span class="p">(</span><span class="n">CACHE_FILE</span><span class="p">):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">CACHE_FILE</span><span class="p">,</span> <span class="s">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">f</span><span class="p">.</span><span class="n">read</span><span class="p">().</span><span class="n">strip</span><span class="p">()</span>
    <span class="k">except</span> <span class="nb">Exception</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">return</span> <span class="bp">None</span>

<span class="k">def</span> <span class="nf">save_cache</span><span class="p">(</span><span class="n">content</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">cache_dir</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">CACHE_FILE</span><span class="p">)</span>
        <span class="n">os</span><span class="p">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">cache_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">CACHE_FILE</span><span class="p">,</span> <span class="s">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
    <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Error saving cache: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">DEPENDENCIES_AVAILABLE</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s">"Required dependencies not installed"</span><span class="p">)</span>
        <span class="k">return</span>
    
    <span class="n">script_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">__file__</span><span class="p">).</span><span class="n">parent</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">script_dir</span> <span class="o">/</span> <span class="n">SERVICE_ACCOUNT_FILE</span><span class="p">).</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">print</span><span class="p">(</span><span class="sa">f</span><span class="s">"Service account file not found: </span><span class="si">{</span><span class="n">SERVICE_ACCOUNT_FILE</span><span class="si">}</span><span class="s">"</span><span class="p">)</span>
        <span class="k">return</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">check_internet</span><span class="p">():</span>
        <span class="n">cached_content</span> <span class="o">=</span> <span class="n">load_cache</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cached_content</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="n">cached_content</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"No internet connection and no cached data"</span><span class="p">)</span>
        <span class="k">return</span>
    
    <span class="n">events</span> <span class="o">=</span> <span class="n">get_events</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">events</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">cached_content</span> <span class="o">=</span> <span class="n">load_cache</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">cached_content</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Using cached data:"</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="n">cached_content</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">"Unable to fetch calendar events"</span><span class="p">)</span>
        <span class="k">return</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">events</span><span class="p">:</span>
        <span class="n">days_text</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"next </span><span class="si">{</span><span class="n">CACHE_DAYS</span><span class="si">}</span><span class="s"> day</span><span class="si">{</span><span class="s">'s'</span> <span class="k">if</span> <span class="n">CACHE_DAYS</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s">''</span><span class="si">}</span><span class="s">"</span> <span class="k">if</span> <span class="n">CACHE_DAYS</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s">"today"</span>
        <span class="n">output</span> <span class="o">=</span> <span class="sa">f</span><span class="s">"No events </span><span class="si">{</span><span class="n">days_text</span><span class="si">}</span><span class="s">"</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">formatted_events</span> <span class="o">=</span> <span class="p">[</span><span class="n">format_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span> <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">]</span>
        <span class="n">output</span> <span class="o">=</span> <span class="s">'</span><span class="se">\n</span><span class="s">'</span><span class="p">.</span><span class="n">join</span><span class="p">(</span><span class="n">formatted_events</span><span class="p">)</span>
    
    <span class="n">save_cache</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">'__main__'</span><span class="p">:</span>
    <span class="n">main</span><span class="p">()</span>
</code></pre></div></div>

<p>Make executable:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">chmod</span> +x get_calendar.py
</code></pre></div></div>

<h3 id="6-conky-integration">6. Conky Integration</h3>

<p>Add to your <code class="language-plaintext highlighter-rouge">.conkyrc</code>:</p>

<div class="language-lua highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">conky</span><span class="p">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">[[
${color orange}${font DejaVu Sans Mono:bold:size=12}UPCOMING EVENTS${font}${color}
${hr 2}
${color lightblue}${exec cd ~/.conky/calendar-project &amp;&amp; pipenv run python get_calendar.py}${color}
${hr 1}
]]</span>
</code></pre></div></div>

<h2 id="testing">Testing</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/.conky/calendar-project
pipenv run python get_calendar.py
</code></pre></div></div>

<p>Expected output:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>08/12 22:00 - Zendesk Redis Withdraw
08/16 08:00 - Weekly Reflection... ↻
08/19 All Day - Credit card bill ↻
</code></pre></div></div>

<h2 id="key-features">Key Features</h2>

<ul>
  <li><strong>Recurring Event Support</strong>: The ↻ symbol indicates recurring events</li>
  <li><strong>Offline Caching</strong>: Falls back to cached data when internet is unavailable</li>
  <li><strong>Configurable Time Range</strong>: Adjust <code class="language-plaintext highlighter-rouge">CACHE_DAYS</code> for different periods</li>
  <li><strong>Timezone Awareness</strong>: Properly handles timezone conversions</li>
  <li><strong>Error Handling</strong>: Graceful degradation on API failures</li>
</ul>

<h2 id="configuration-options">Configuration Options</h2>

<table>
  <thead>
    <tr>
      <th>Variable</th>
      <th>Description</th>
      <th>Example</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">CACHE_DAYS</code></td>
      <td>Days to look ahead</td>
      <td><code class="language-plaintext highlighter-rouge">7</code> (one week)</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">MAX_EVENTS</code></td>
      <td>Maximum events to display</td>
      <td><code class="language-plaintext highlighter-rouge">10</code></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">CALENDAR_ID</code></td>
      <td>Which calendar to use</td>
      <td><code class="language-plaintext highlighter-rouge">primary</code> or email</td>
    </tr>
  </tbody>
</table>

<h2 id="troubleshooting">Troubleshooting</h2>

<p><strong>“Service account file not found”</strong></p>
<ul>
  <li>Verify the JSON file is in the project directory</li>
  <li>Check the filename matches your <code class="language-plaintext highlighter-rouge">.env</code> configuration</li>
</ul>

<p><strong>“Access denied”</strong></p>
<ul>
  <li>Ensure the service account email has calendar permissions</li>
  <li>Wait a few minutes after sharing for propagation</li>
</ul>

<p><strong>“No events found”</strong></p>
<ul>
  <li>Verify <code class="language-plaintext highlighter-rouge">CALENDAR_ID</code> is correct</li>
  <li>Check if events exist in the specified time range</li>
  <li>Try increasing <code class="language-plaintext highlighter-rouge">CACHE_DAYS</code></li>
</ul>

<h2 id="security-considerations">Security Considerations</h2>

<ul>
  <li>Service account files contain sensitive credentials</li>
  <li>Use <code class="language-plaintext highlighter-rouge">chmod 600</code> on credential files</li>
  <li>Consider restricting API key to specific APIs in Google Cloud Console</li>
  <li>The service account only needs read access to calendars</li>
</ul>

<h2 id="limitations">Limitations</h2>

<ul>
  <li>Requires internet connectivity for fresh data (cached data available offline)</li>
  <li>Service account must be shared with each calendar individually</li>
  <li>Google Calendar API has usage quotas (generous for personal use)</li>
</ul>

<p>This implementation provides a robust solution for displaying calendar events in Conky with proper support for recurring events and offline functionality.</p>

			<footer>
				<div class="blocked tags">
					<p>
						
						<a href="/blog/tags/conky">Conky</a> |
						
					</p>
				</div>
			</footer>

			<br />



			<div class="hr"></div>

		</article>

		<div class="c">&nbsp;</div>

	</div>


</section>

<div class="c">&nbsp;</div>

        </div>


        <footer id="footer" class="row">

            <p id="copyright">
                &copy; 2011-2026 Madhur Ahuja
            </p>
            <p id="poweredby" class="visible-lg visible-md">
                Powered by <a href="http://jekyllrb.com">Jekyll</a> and <a href="http://github.com/">Github</a>.
            </p>

            <div class="c">&nbsp;</div>


        </footer>


    </div>

    <script src="/files/js/main.js"></script> 
    

    <!-- serviceWorker.html -->
    <script>
        if ('serviceWorker' in navigator) {

            navigator.serviceWorker.getRegistrations().then(function (registrations) {
                for (let registration of registrations) {
                    registration.unregister()
                }
            })
        }

// if ('serviceWorker' in navigator) {
//     navigator.serviceWorker.register('/serviceWorker.js').then(function(reg) {
//         if (!reg.installing) return;
//         console.log("[*] ServiceWorker is installing...");

//         var worker = reg.installing;
//         worker.addEventListener('statechange', function() {
//             if (worker.state == 'redundant') {
//                 console.log('[*] Install failed');
//             }
//             if (worker.state == 'installed') {
//                 console.log('[*] Install successful!');
//             }
//         });
//     });
// }

    </script>

</body>

</html>