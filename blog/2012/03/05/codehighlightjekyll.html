<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8" />
    
        <title>Enable code highlighting with Pygments/Jekyll &#8211; Madhur Ahuja</title>
    

    <meta name="author" content="Madhur Ahuja" />
    <meta name="description" content=" Enable code highlighting with Pygments/Jekyll" />

    <link rel="start" href="/" />

    <link rel="alternate" type="application/atom+xml" href="http://feeds.feedburner.com/madhur" title="RSS feed" />
    <link rel="shortcut icon" href="http://www.gravatar.com/avatar/5352cde0b084abcd6d4d783c08a51c76?s=16" />

    <link rel="stylesheet" href="/files/css/bootstrap.min.css" type="text/css" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="/files/font-awesome/css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="/files/css/jquery.fancybox.css" type="text/css" />

    <link rel="stylesheet" type="text/css" href="/files/css/styles.css" />
    
    
    <link rel="stylesheet" type="text/css" href="/files/css/syntax.css" />
    

    <link rel="stylesheet" type="text/css" media="print" href="/files/css/print.css">

     
   
    <script src="/files/js/vendor/pace.min.js" type="text/javascript"></script>
</head>

<body>

    <div class="container">
       
            <header id="header" class="row">

                <nav id="navigation" class="navbar navbar-inverse navbar-fixed-top " role="navigation">
    <div class="container">

    <div class="navbar-header">

     <div class="hidden-md hidden-sm hidden-lg searchli">

                <form method="get" role="search" id="searchform" action="/results" onsubmit="return checkfrm_search();">

                    <div class="form-group">
                        <input type="search" required id="q2" name="q" value="" class="form-control mobile" placeholder="Search" />
                    </div>
                </form>
        </div>

        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#mainmenu">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <!--  <a class="navbar-brand " href="/">Home</a> -->
    </div>

    <div class="collapse navbar-collapse" id="mainmenu">
        <ul id="nav" class="nav navbar-nav">
            
            <li><a class="home" href="/">Home</a>
            </li>
            <li><a class="blog" href="/blog">Blog</a>
            </li>
            <!--<li><a class="work" href="/work">Resume</a></li>-->
            <li><a class="code" href="/projects">Work</a>
            </li>
            <!--<li><a class="papers" href="/papers">Papers</a></li>-->
            <li><a class="info" href="/info">About</a>
            </li>
            <li><a class="contact" href="/contact">Contact</a>
            </li>

        </ul>

        <ul class="nav navbar-nav visible-md visible-lg visible-sm searchbox">
            <li>
                <form method="get" role="search" id="searchform" action="/results" onsubmit="return checkfrm_search();">

                    <div class="form-group">
                        <input type="search" required id="q1" name="q" value="" class="form-control desktop" placeholder="Search" />
                    </div>
                </form>
            </li>
        </ul>


        <ul class="nav-icons navbar-right nav navbar-nav visible-md visible-lg">
            <li><a href="http://www.linkedin.com/in/madhurahuja"><i class="fa fa-linkedin-square fa-3x"></i></a>
            </li>
            <li><a href="https://github.com/madhur"><i class="fa fa-github fa-3x"></i></a>
            </li>
            <li><a href="http://feeds.feedburner.com/madhur"><i class="fa fa-rss-square fa-3x"></i></a>
            </li>
        </ul>


    </div>

</div>
</nav>


            </header>
       
        <div id="content" class="row">

            <section>

	<div id="blogcontent">

		<!--<aside class="postmeta col-md-3 hidden-print visible-md visible-lg">

			

		</aside>-->

		<article id="blog-article" class="post col-md-12 clearfix">

				<header><h1>Enable code highlighting with Pygments/Jekyll</h1></header>
			
					<!-- Place this tag where you want the +1 button to render -->
<div class="row social hidden-xs">
	<div class="col-md-2 col-sm-2">
		<time datetime="2012-03-05 00:00:00 +0530" pubdate="pubdate">05 March 2012</time>
	</div>
    <div class="social-icon col-md-1 col-sm-1">
        <div class="g-plusone" data-size="small"></div>
    </div>
    <div class="social-icon col-md-1 col-sm-2">
        <a href="https://twitter.com/share?count=vertical" class="twitter-share-button" data-via="madhur25">Tweet</a>
        <script>
        ! function(d, s, id) {
            var js, fjs = d.getElementsByTagName(s)[0],
                p = /^http:/.test(d.location) ? 'http' : 'https';
            if (!d.getElementById(id)) {
                js = d.createElement(s);
                js.id = id;
                js.src = p + '://platform.twitter.com/widgets.js';
                fjs.parentNode.insertBefore(js, fjs);
            }
        }(document, 'script', 'twitter-wjs');
        </script>
    </div>
    <div class="social-icon col-md-1 col-sm-2">
        <script src="//platform.linkedin.com/in.js" type="text/javascript">
        lang: en_US
        </script>
        <script type="IN/Share" data-counter="right"></script>
    </div>

    <div class="social-icon col-md-1 col-sm-2">
        <a href="http://bufferapp.com/add" class="buffer-add-button" data-count="horizontal">Buffer</a>
        <script type="text/javascript" src="https://d389zggrogs7qo.cloudfront.net/js/button.js"></script>
    </div>
    <div class="social-icon col-md-1 col-sm-2">
        <a data-pocket-label="pocket" data-pocket-count="horizontal" class="pocket-btn" data-lang="en"></a>
        <script type="text/javascript">
        ! function(d, i) {
            if (!d.getElementById(i)) {
                var j = d.createElement("script");
                j.id = i;
                j.src = "https://widgets.getpocket.com/v1/j/btn.js?v=1";
                var w = d.getElementById(i);
                d.body.appendChild(j);
            }
        }(document, "pocket-btn-js");
        </script>
    </div>
				<div class="social-icon col-md-2 col-sm-2">
<script type="text/javascript" src="//www.redditstatic.com/button/button1.js"></script>
				</div>

	
</div>
<!-- Place this tag after the last plusone tag -->
<!-- Place this tag after the last +1 button tag. -->
<script type="text/javascript">
(function() {
    var po = document.createElement('script');
    po.type = 'text/javascript';
    po.async = true;
    po.src = 'https://apis.google.com/js/platform.js';
    var s = document.getElementsByTagName('script')[0];
    s.parentNode.insertBefore(po, s);
})();
</script>


			<hr style="margin-top:0px" />


			 <p>If you have been using Jekyll, you must be aware of code highlighting feature using highlight blocks. This highlighting is accomplished by
a neat python script called <a href="http://pygments.org/">Pygments</a></p>

<p>Pygments is a very powerful code syntax highlighter. It allows you to pass various options such as weather to display line no.s or which lines to be highlighted.
When Jekyll was released, there was no way to use these options since Jekyll encapsulated the execution of Python internally through <a href="https://github.com/github/albino">Albino gem</a></p>

<p>There has been some progress over this, a <a href="https://github.com/mojombo/jekyll/issues/31">pull request</a> was submitted in Jekyll which allowed various options to be passed to Pygments.</p>

<p>However, when I tried to use <strong>hl_lines</strong> option to highlight the lines of code, I faced several issues. Following is the syntax I used</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"> highlight html hl_lines=2 4</code></pre></figure>

<p>Running the above piece of code reults in only line 2 being highlighted and not both. So I decided to enclose it with quotation marks</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text"> highlight html hl_lines="2 4"  </code></pre></figure>

<p>The above piece of code gives the error. </p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">Invalid flag value -O</code></pre></figure>

<p>Certainly, there are some things which needs to be fixed. First of all in albino, the validation function has a bug. The value regular express should be allowed quotation marks character so that hl_lines list can be provided enclosed in quotation marks. This is the first problem in <strong>albino.rb</strong> file.</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">  <span class="k">def</span> <span class="nf">validate_shell_args</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">flag</span> <span class="o">!~</span> <span class="sr">/^[a-z]+$/i</span>
      <span class="k">raise</span> <span class="no">ShellArgumentError</span><span class="p">,</span> <span class="s2">"Flag is invalid: </span><span class="si">#{</span><span class="n">flag</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">!~</span> <span class="sr">/^[a-z0-9\-\_\+\=\#\,\s]+$/i</span>
      <span class="k">raise</span> <span class="no">ShellArgumentError</span><span class="p">,</span> <span class="s2">"Flag value is invalid: -</span><span class="si">#{</span><span class="n">flag</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">value</span><span class="p">.</span><span class="nf">inspect</span><span class="si">}</span><span class="s2">"</span>
    <span class="k">end</span>
  <span class="k">end</span></code></pre></figure>

<p>The second problem is that we can seperate the hl_lines list with spaces since Jekyll uses the space as a delimeter to parse these options. To solve this problem, I pass in the list seperated by commas and then modified the 
<strong>highlight.rb</strong> file in Jekyll to recombine them into the list. See the updated function below:</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"> <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">tag_name</span><span class="p">,</span> <span class="n">markup</span><span class="p">,</span> <span class="n">tokens</span><span class="p">)</span>
      <span class="k">super</span>   
      <span class="k">if</span> <span class="n">markup</span> <span class="o">=~</span> <span class="no">SYNTAX</span>  
        <span class="vi">@lang</span> <span class="o">=</span> <span class="vg">$1</span>
        <span class="k">if</span> <span class="n">defined?</span> <span class="vg">$2</span>
        <span class="c1"># puts $2</span>
          <span class="n">tmp_options</span> <span class="o">=</span> <span class="p">{}</span>
          <span class="vg">$2</span><span class="p">.</span><span class="nf">split</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">opt</span><span class="o">|</span>          
            <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">opt</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s1">'='</span><span class="p">)</span>                     
            <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">'hl_lines'</span>
                <span class="nb">puts</span> <span class="n">value</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">.</span><span class="nf">gsub</span><span class="p">(</span><span class="s2">","</span><span class="p">,</span><span class="s2">" "</span><span class="p">)</span>
            <span class="k">end</span>          
            <span class="k">if</span> <span class="n">value</span><span class="p">.</span><span class="nf">nil?</span>
              <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">'linenos'</span>          
                <span class="n">value</span> <span class="o">=</span> <span class="s1">'inline'</span>
              <span class="k">else</span>
                <span class="n">value</span> <span class="o">=</span> <span class="kp">true</span>
              <span class="k">end</span>
            <span class="k">end</span>
            <span class="n">tmp_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
          <span class="k">end</span>
          <span class="n">tmp_options</span> <span class="o">=</span> <span class="n">tmp_options</span><span class="p">.</span><span class="nf">to_a</span><span class="p">.</span><span class="nf">collect</span> <span class="p">{</span> <span class="o">|</span><span class="n">opt</span><span class="o">|</span> <span class="n">opt</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s1">'='</span><span class="p">)</span> <span class="p">}</span>
          
          <span class="c1"># additional options to pass to Albino</span>
          <span class="vi">@options</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">'O'</span> <span class="o">=&gt;</span> <span class="n">tmp_options</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s1">','</span><span class="p">)</span> <span class="p">}</span>                          
        <span class="k">else</span>
          <span class="vi">@options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">end</span>
      <span class="k">else</span>
        <span class="k">raise</span> <span class="no">SyntaxError</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="s2">"Syntax Error in 'highlight' - Valid syntax: highlight &lt;lang&gt; [linenos]"</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span></code></pre></figure>

<p>I cannot submit it as patch in Jekyll since this fix involves fixing two components: Jekyll and Albino. May be someone can come with better approach to fix this. This works for me as of now.  </p>

			<footer>
				<div class="blocked tags">
					<p>
					
						<a href="/blog/tags/jekyll">Jekyll</a> |
					
					</p>
				</div>
			</footer>
			
			<br/>
		
			
			
			<div class="hr"></div>

		


			<!-- Discus Comments -->
			<div id="disqus_thread"></div>

			
			<!-- Enable Disqus comments -->
			<script type="text/javascript">
  var disqus_developer = 0; // developer mode is on
  var disqus_shortname = 'madhur';
  var disqus_identifier = '/2012/03/05/codehighlightjekyll/';
  var disqus_title = 'Enable code highlighting with Pygments/Jekyll';
  var disqus_url = 'http://madhur.co.in/blog/2012/03/05/codehighlightjekyll.html';
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();

</script>

			
			
			
			

		</article>

		<div class="c">&nbsp;</div>

	</div>

	
</section>
 
<div class="c">&nbsp;</div>


  
<script type="text/javascript">
    
    var disqus_shortname = 'madhur'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

 

 



        </div>


        <footer id="footer" class="row">

            <p id="copyright">
                &copy; 2011-2017 Madhur Ahuja
            </p>
            <p id="poweredby" class="visible-lg visible-md">
                Powered by
                <a href="http://jekyllrb.com" title="A static, minimalist CMS">Jekyll</a>, <a href="http://github.com/">Github</a> and <a href="http://disqus.com">Disqus</a>.
            </p>

            <div class="c">&nbsp;</div>


        </footer>


    </div>

    <script data-main="/files/js/app" src="/files/js/require.js"></script>

    
        <script type="text/javascript">
	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-23769089-1']);
	  _gaq.push(['_trackPageview']);

	  (function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();

	</script>
    

    <!-- serviceWorker.html -->
<script>
if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('/serviceWorker.js').then(function(reg) {
        if (!reg.installing) return;
        console.log("[*] ServiceWorker is installing...");

        var worker = reg.installing;
        worker.addEventListener('statechange', function() {
            if (worker.state == 'redundant') {
                console.log('[*] Install failed');
            }
            if (worker.state == 'installed') {
                console.log('[*] Install successful!');
            }
        });
    });
}

</script>

</body>

</html>
