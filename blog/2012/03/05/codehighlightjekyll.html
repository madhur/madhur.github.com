<!DOCTYPE html>

<html lang="en">
<head>
   <meta charset="utf-8" />
   <title>Enable code highlighting with Pygments/Jekyll &#8211; Madhur Ahuja</title>
   <meta name="author" content="Madhur Ahuja" />
   
    
		<meta name="description" content=" Enable code highlighting with Pygments/Jekyll" />
	

    <link rel="start" href="/" />

	
	
  	<link rel="alternate" type="application/atom+xml" href="http://feeds.feedburner.com/madhur" title="RSS feed" />
	<link rel="shortcut icon" href="http://www.gravatar.com/avatar/5352cde0b084abcd6d4d783c08a51c76?s=16" />
   
	<link rel="stylesheet" href="/files/css/blueprint/screen.css" type="text/css" />   	
	<!--<link rel="stylesheet" href="/files/css/disqus-form.css" type="text/css" /> -->
	
	<!--<link rel="stylesheet" href="/files/css/syntax.css" type="text/css" />-->
	<link rel="stylesheet" href="/files/font-awesome/css/font-awesome.min.css" type="text/css" />
	<link rel="stylesheet" href="/files/css/jquery.fancybox.css" type="text/css" />
	
	<link rel="stylesheet" type="text/css" href="/files/css/styles.css" />
	
	
		<link rel="stylesheet" type="text/css" href="/files/css/syntax.css" />
	
			
   <link rel="stylesheet" type="text/css" media="print" href="/files/css/print.css">
   
   
	<script src="/files/js/jquery.js" type="text/javascript"></script>	
	<script src="/files/js/jquery.fancybox.pack.js" type="text/javascript"></script>
	
	<!--[if lt IE 9]>
		<script src="/files/js/modernizr-2.5.3.js" type="text/javascript"></script>
	<![endif]-->
	
	<script type="text/javascript">
	var disqus_iframe_css = 'http://madhur.co.in/files/css/disqus-form.css';
	</script>
	
	
	<script src="/files/js/URI.js" type="text/javascript"></script>
	<script src="/files/js/site.js" type="text/javascript"></script>
	
	<script type="text/javascript">
	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-23769089-1']);
	  _gaq.push(['_trackPageview']);

	  (function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();

	</script>
		
	
</head>
<body>
<div id="gradient">
	<div id="container" class="container">
		<header id="header" class="span-24 last">

			<div id="logo">
<ul>
<li><a href="http://www.linkedin.com/in/madhurahuja"><img src="/images/linkedinhigh.png" /></a></li>
<li><a href="https://github.com/madhur"><img src="/images/github_32.png"/></a></li>
<li><a href="http://feeds.feedburner.com/madhur"><img src="/images/rsshigh.png" /></a></li>
</ul>
</div>


<nav id="navigation">
				<ul id="nav">
					<li><a class="madhur" href="/">Madhur Ahuja</a></li>
					<li><a class="home" href="/">Home</a></li>
					<li><a class="blog" href="/blog">Blog</a></li>
					<!--<li><a class="work" href="/work">Resume</a></li>-->
					<li><a class="code" href="/projects">Projects</a></li>
					<!--<li><a class="papers" href="/papers">Papers</a></li>--> 
					<li><a class="info" href="/info">About</a></li>
					<li><a class="contact" href="/contact">Contact</a></li>

				</ul>
				
				
</nav>
<div class="c">
&nbsp;
</div>



		</header>
		<div id="content" class="span-24 last">

			<section id="primary" class="span-24 last">

	<div id="blogcontent">

		<aside class="postmeta full span-5">

			<div class="timestamp">
	<time datetime="2012-03-05 00:00:00 +0530" pubdate="pubdate">05 March 2012</time>

	<br>
	<span pubdate="pubdate" class="time">9:00 PM</span>
</div> 

<div class="actions">
<ul> 
								<li><a href="/blog/2012/03/05/codehighlightjekyll.html#disqus_thread" data-disqus-identifier="/2012/03/05/codehighlightjekyll/" class="comment">View Comments</a></li> 

<script type="text/javascript">

	var disqus_developer = 0;
		var disqus_shortname = 'madhur';
		var disqus_iframe_css = "http://madhur.github.com/css/screen.css";
			var links = document.getElementsByTagName('a');
			var query = '?';
			
					query += 'url=' + encodeURIComponent(window.location.href) + '&';
					//alert(query);
				
			
	document.write('<script type="text/javascript" src="http://disqus.com/forums/madhur/get_num_replies.js?url2=' + encodeURIComponent(window.location.url) + '#disqus_thread"></' + 'script>');
	

</script>


								<li><span class="share" title="Click to expand">share this post</span> 
									<ul class="sharing" style="display:none"> 
										<li class="first"><a href="http://blinklist.com/index.php?Action=Blink/addblink.php&amp;Url=/blog/2012/03/05/codehighlightjekyll.html&amp;Title=Enable code highlighting with Pygments/Jekyll" id="share_blinklist" title="Share on BlinkList" rel="nofollow">BlinkList</a></li> 
										<li><a href="http://del.icio.us/post?url=http://madhur.co.in/blog/2012/03/05/codehighlightjekyll.html&amp;title=Enable code highlighting with Pygments/Jekyll" id="share_delicious" title="Add to del.icio.us" rel="nofollow">del.icio.us</a></li> 
										<li><a href="http://digg.com/submit?url=http://madhur.co.in/blog/2012/03/05/codehighlightjekyll.html" id="share_digg" title="Digg This!" rel="nofollow">Digg</a></li> 
										<li><a href="http://www.facebook.com/share.php?u=http://madhur.co.in/blog/2012/03/05/codehighlightjekyll.html" id="share_facebook" title="Share on Facebook" rel="nofollow">Facebook</a></li> 
										<li><a href="http://reddit.com/submit?url=http://madhur.co.in/blog/2012/03/05/codehighlightjekyll.html&amp;title=Enable code highlighting with Pygments/Jekyll" id="share_reddit" title="Share on Reddit" rel="nofollow">Reddit</a></li> 
										<li><a href="http://www.stumbleupon.com/submit?url=http://madhur.co.in/blog/2012/03/05/codehighlightjekyll.html&amp;title=Enable code highlighting with Pygments/Jekyll" id="share_stumbleupon" title="Share on StumbleUpon" rel="nofollow">StumbleUpon</a></li> 
										<li><a href="http://twitter.com/home?status=http://madhur.co.inEnable code highlighting with Pygments/Jekyll%3A%20/blog/2012/03/05/codehighlightjekyll.html" id="share_twitter" title="Tweet this!" rel="nofollow">Twitter</a></li> 
										<li class="last"><a href="http://www.technorati.com/faves?add=http://madhur.co.in/blog/2012/03/05/codehighlightjekyll.html" id="share_technorati" title="Favourite on Technorati" rel="nofollow">Technorati</a></li> 
									</ul> 
								</li> 
								<li><a href="http://feeds.feedburner.com/madhur" class="subscribe">subscribe to this blog</a></li> 
								
								<li><a href="javascript:Clickheretoprint()" class="subscribe">print this page</a></li> 								
								<li><a href="/blog/2012/03/05/codehighlightjekyll.html" class="permalink">permalink</a></li> 
															</ul> 

</div>

<div class="category">
<h3>Advert</h3>
	<script type="text/javascript"><!--
google_ad_client = "ca-pub-1657163894706869";
/* madhur.co.in right side */
google_ad_slot = "3156850124";
google_ad_width = 160;
google_ad_height = 600;
//-->
</script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>


</div>


		</aside>

		<article class="post full span-18 last">
					<header><h1>Enable code highlighting with Pygments/Jekyll</h1></header>
			 <p>If you have been using Jekyll, you must be aware of code highlighting feature using highlight blocks. This highlighting is accomplished by
a neat python script called <a href="http://pygments.org/">Pygments</a></p>

<p>Pygments is a very powerful code syntax highlighter. It allows you to pass various options such as weather to display line no.s or which lines to be highlighted.
When Jekyll was released, there was no way to use these options since Jekyll encapsulated the execution of Python internally through <a href="https://github.com/github/albino">Albino gem</a></p>

<p>There has been some progress over this, a <a href="https://github.com/mojombo/jekyll/issues/31">pull request</a> was submitted in Jekyll which allowed various options to be passed to Pygments.</p>

<p>However, when I tried to use <strong>hl_lines</strong> option to highlight the lines of code, I faced several issues. Following is the syntax I used</p>

<div class="highlight"><pre><code class="text"> highlight html hl_lines=2 4
</code></pre></div>

<p>Running the above piece of code reults in only line 2 being highlighted and not both. So I decided to enclose it with quotation marks</p>

<div class="highlight"><pre><code class="text"> highlight html hl_lines=&quot;2 4&quot;  
</code></pre></div>

<p>The above piece of code gives the error. </p>

<div class="highlight"><pre><code class="text">Invalid flag value -O
</code></pre></div>

<p>Certainly, there are some things which needs to be fixed. First of all in albino, the validation function has a bug. The value regular express should be allowed quotation marks character so that hl_lines list can be provided enclosed in quotation marks. This is the first problem in <strong>albino.rb</strong> file.</p>

<div class="highlight"><pre><code class="ruby">  <span class="k">def</span> <span class="nf">validate_shell_args</span><span class="p">(</span><span class="n">flag</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">flag</span> <span class="o">!~</span> <span class="sr">/^[a-z]+$/i</span>
      <span class="k">raise</span> <span class="no">ShellArgumentError</span><span class="p">,</span> <span class="s2">&quot;Flag is invalid: </span><span class="si">#{</span><span class="n">flag</span><span class="o">.</span><span class="n">inspect</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="n">value</span> <span class="o">!~</span> <span class="sr">/^[a-z0-9\-\_\+\=\#\,\s]+$/i</span>
      <span class="k">raise</span> <span class="no">ShellArgumentError</span><span class="p">,</span> <span class="s2">&quot;Flag value is invalid: -</span><span class="si">#{</span><span class="n">flag</span><span class="si">}</span><span class="s2"> </span><span class="si">#{</span><span class="n">value</span><span class="o">.</span><span class="n">inspect</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">end</span>
  <span class="k">end</span>
</code></pre></div>

<p>The second problem is that we can seperate the hl_lines list with spaces since Jekyll uses the space as a delimeter to parse these options. To solve this problem, I pass in the list seperated by commas and then modified the 
<strong>highlight.rb</strong> file in Jekyll to recombine them into the list. See the updated function below:</p>

<div class="highlight"><pre><code class="ruby"> <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">tag_name</span><span class="p">,</span> <span class="n">markup</span><span class="p">,</span> <span class="n">tokens</span><span class="p">)</span>
      <span class="k">super</span>	 
      <span class="k">if</span> <span class="n">markup</span> <span class="o">=~</span> <span class="no">SYNTAX</span>	
        <span class="vi">@lang</span> <span class="o">=</span> <span class="vg">$1</span>
        <span class="k">if</span> <span class="n">defined?</span> <span class="vg">$2</span>
		<span class="c1"># puts $2</span>
          <span class="n">tmp_options</span> <span class="o">=</span> <span class="p">{}</span>
          <span class="vg">$2</span><span class="o">.</span><span class="n">split</span><span class="o">.</span><span class="n">each</span> <span class="k">do</span> <span class="o">|</span><span class="n">opt</span><span class="o">|</span>		    
            <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">opt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span>						
			<span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;hl_lines&#39;</span>
				<span class="nb">puts</span> <span class="n">value</span>
				<span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">gsub</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">)</span>
			<span class="k">end</span>			
            <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">nil?</span>
              <span class="k">if</span> <span class="n">key</span> <span class="o">==</span> <span class="s1">&#39;linenos&#39;</span>			
                <span class="n">value</span> <span class="o">=</span> <span class="s1">&#39;inline&#39;</span>
			  <span class="k">else</span>
                <span class="n">value</span> <span class="o">=</span> <span class="kp">true</span>
              <span class="k">end</span>
            <span class="k">end</span>
            <span class="n">tmp_options</span><span class="o">[</span><span class="n">key</span><span class="o">]</span> <span class="o">=</span> <span class="n">value</span>
          <span class="k">end</span>
          <span class="n">tmp_options</span> <span class="o">=</span> <span class="n">tmp_options</span><span class="o">.</span><span class="n">to_a</span><span class="o">.</span><span class="n">collect</span> <span class="p">{</span> <span class="o">|</span><span class="n">opt</span><span class="o">|</span> <span class="n">opt</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">)</span> <span class="p">}</span>
		  
          <span class="c1"># additional options to pass to Albino</span>
          <span class="vi">@options</span> <span class="o">=</span> <span class="p">{</span> <span class="s1">&#39;O&#39;</span> <span class="o">=&gt;</span> <span class="n">tmp_options</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="p">}</span>		  		  		  
        <span class="k">else</span>
          <span class="vi">@options</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">end</span>
      <span class="k">else</span>
        <span class="k">raise</span> <span class="no">SyntaxError</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;Syntax Error in &#39;highlight&#39; - Valid syntax: highlight &lt;lang&gt; [linenos]&quot;</span><span class="p">)</span>
      <span class="k">end</span>
    <span class="k">end</span>
</code></pre></div>

<p>I cannot submit it as patch in Jekyll since this fix involves fixing two components: Jekyll and Albino. May be someone can come with better approach to fix this. This works for me as of now.	</p>

			<footer>
				<div class="blocked tags">
					<p>
					
						<a href="/tags/jekyll">Jekyll</a> |
					
					</p>
				</div>
			</footer>
			
			<br/>
			<div>


				<!-- Enable Google Plus comments -->
				<!-- Place this tag where you want the +1 button to render -->
<div class="social">
<g:plusone></g:plusone>

<a href="https://twitter.com/share" class="twitter-share-button" data-via="madhur25">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

<fb:like href="http://madhur.co.in/blog/2012/03/05/codehighlightjekyll.html" send="true" layout="button_count" width="450" show_faces="true" colorscheme="dark" font="lucida grande"></fb:like>
</div>


<!-- Place this tag after the last plusone tag -->
<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>


			</div>
			
			
			<div class="hr"></div>

		


			<!-- Discus Comments -->
			<div id="disqus_thread"></div>

			
			<!-- Enable Disqus comments -->
			<script type="text/javascript">
  var disqus_developer = 0; // developer mode is on
  var disqus_shortname = 'madhur';
  var disqus_identifier = '/2012/03/05/codehighlightjekyll/';
  var disqus_title = 'Enable code highlighting with Pygments/Jekyll';
  var disqus_url = 'http://madhur.co.in/blog/2012/03/05/codehighlightjekyll.html';
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();

</script>

			
			
			

		</article>

		<div class="c">&nbsp;</div>

	</div>

	
</section>
 
<div class="c">&nbsp;</div>


  
<script type="text/javascript">
    
    var disqus_shortname = 'madhur'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

 

 



		</div>
		  
		<footer id="footer" class="span-24 last">
			
				<p id="copyright">
					&copy; 2011-2014
					Madhur Ahuja
				</p>
				<p id="poweredby">
					Powered by 
					<a href="http://jekyllrb.com" title="A static, minimalist CMS">Jekyll</a>, <a href="http://github.com/">Github</a> and <a href="http://disqus.com">Disqus</a>.
				</p>

				<div class="c">&nbsp;</div>

			
		</footer>

	</div>

</div>

</body>
</html>
