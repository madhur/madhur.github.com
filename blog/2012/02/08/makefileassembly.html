<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8" /> 
    <title>Using MakeFile with Assembly Programming &#8211; Madhur Ahuja</title>
    

    <meta name="author" content="Madhur Ahuja" />
    <meta name="description" content=" Using MakeFile with Assembly Programming" />

    <link rel="start" href="/" />

    <link rel="alternate" type="application/atom+xml" href="http://feeds.feedburner.com/madhur" title="RSS feed" />
    <link rel="shortcut icon" href="http://www.gravatar.com/avatar/5352cde0b084abcd6d4d783c08a51c76?s=16" />

    <link rel="stylesheet" href="/files/css/bootstrap.min.css" type="text/css" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="/files/font-awesome/css/font-awesome.min.css" type="text/css" />
    <script src="/files/js/vendor/fancybox.umd.js" tpye="text/javascript"></script>
    <link rel="stylesheet" href="/files/css/fancybox.css" type="text/css" />

    <link rel="stylesheet" type="text/css" href="/files/css/styles.css" /> 
    <link rel="stylesheet" type="text/css" href="/files/css/syntax.css" /> 

     <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-N14VDHYFHQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-N14VDHYFHQ');
</script> 
    <link rel="stylesheet" type="text/css" media="print" href="/files/css/print.css"> 

    <script src="/files/js/vendor/pace.min.js" type="text/javascript"></script>
</head>


<body>

    <div class="container">

        <header id="header" class="row">

            <nav id="navigation" class="navbar navbar-inverse navbar-fixed-top top-nav-collapse" role="navigation">
    <div class="container">

        <div class="navbar-header">

            <div class="hidden-md hidden-sm hidden-lg searchli">

                <form method="get" role="search" id="searchform" action="/results" onsubmit="return checkfrm_search();">

                    <div class="form-group">
                        <input type="search" required id="q2" name="q" value="" class="form-control mobile"
                            placeholder="Search" />
                    </div>
                </form>
            </div>

            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#mainmenu">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <!--  <a class="navbar-brand " href="/">Home</a> -->
        </div>

        <div class="collapse navbar-collapse" id="mainmenu">
            <ul id="nav" class="nav navbar-nav">

                <li><a class="home" href="/">Home</a>
                </li>
                <li><a class="blog" href="/blog">Blog</a>
                </li>
                <!--<li><a class="work" href="/work">Resume</a></li>-->
                <li><a class="code" href="/projects">Work</a>
                </li>
                <!--<li><a class="papers" href="/papers">Papers</a></li>-->
                <li><a class="info" href="/info">About</a>
                </li>
                <li><a class="contact" href="/contact">Contact</a>
                </li>

            </ul>

            <ul class="nav navbar-nav visible-md visible-lg visible-sm searchbox">
                <li>
                    <form method="get" role="search" id="searchform" action="/results"
                        onsubmit="return checkfrm_search();">

                        <div class="form-group">
                            <input type="search" required id="q1" name="q" value="" class="form-control desktop"
                                placeholder="Search" />
                        </div>
                    </form>
                </li>
            </ul>


            <ul class="nav-icons navbar-right nav navbar-nav visible-md visible-lg">
                <li><a href="http://www.linkedin.com/in/madhurahuja"><i class="fa fa-linkedin-square fa-3x"></i></a>
                </li>
                <li><a href="https://github.com/madhur"><i class="fa fa-github fa-3x"></i></a>
                </li>
                <li><a href="http://feeds.feedburner.com/madhur"><i class="fa fa-rss-square fa-3x"></i></a>
                </li>
            </ul>


        </div>

    </div>
</nav>

        </header>

        <div id="content" class="row">

            <section>

	<div id="blogcontent">


		<article id="blog-article" class="post col-md-12 clearfix">

			<header>
				<h1>Using MakeFile with Assembly Programming</h1>
			</header>

			



<div class="post-meta">
    <time datetime="2012-02-08T00:00:00+05:30">February 08, 2012</time>
    <span class="reading-time">3 min read</span>
</div>


			<hr style="margin-top:0px" />


			<p>I have been a big fan of assembly programming since my old school days. The raw power of CPU which you get is just pure awesome.
But, with that power, you also get much headache of non-availablity of standard IDEâ€™s for using Assembly language.</p>

<ul>
  <li>
    <p>Visual Studio is one of the options, but it restricts you to the installed version of Microsoft Macro Assembler (ml.exe)</p>
  </li>
  <li>
    <p>Some prefer using QEditor.exe which ships with <a href="http://masm32.com">MASM32 SDK</a></p>
  </li>
  <li>
    <p>Some like me, just cannot stay away from there favourite editors such as Notepad++, Ultraedit etc.</p>
  </li>
</ul>

<p>The benefit of using editors such as Notepad++, Ultraedit is that you get fully customizable syntax highlighting and command line tools
to be used while assembling and linking their programs. However, with these tools you have to add commands to both assemble and link your programs. And if you are like me,
who fiddles with 16bit, 32bit and 64 bit assembly programs, you have to add seperate commands for them. And not to forget, seperate commands for outputting debug and release binaries as well.</p>

<p>To simplify the above process, I have been exploring the use of makefiles to assemble and link my programs and this has worked wonderfully well. I just maintain my each assembly project in seperate directory with the makefile
and use that as a command to assembly and link the program from <a href="http://notepad-plus-plus.org/">Notepad++</a>, using <a href="https://sourceforge.net/projects/npp-plugins/files/NppExec/">NppExec plugin</a>. Apart from Notepad++, I am using following tools as my development environment. You might be using different, but they can be applied in same concept.</p>

<ol>
  <li>NMAKE(nmake.exe) v10.00.30319.01 which ships with Visual Studio 2010 available <a href="http://www.microsoft.com/visualstudio/en-in">here</a></li>
  <li>Borland Resource compiler (brcc32.exe) v4.50 which ships with Borland compiler tools available somewhere on the net</li>
  <li>Microsoft Macro Assembler(ml.exe) v6.14 and Linker (link.exe) v5.12 which ships with Masm 32 SDK available <a href="http://www.masm32.com/">here</a></li>
</ol>

<p>Note that all the above tools should be put preferable in the PATH variable for easy access. I do this by creating a simple command script as follows:</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">setx PATH "f:\common tools\git\bin;f:\common tools\python\app;f:\common tools\python\app\scripts;f:\common tools\ruby\bin;f:\masm32\bin;F:\Borland\BCC55\Bin;"</code></pre></figure>

<p>I am going to show you some scenarios here on how I am using Makefiles to assemble and link my programs. Note that this is not a tutorial for using makefiles. I assume you have some basic familiarity with it.</p>

<ul>
  <li>A Win32 Assembly program without the use of resources:</li>
</ul>

<figure class="highlight"><pre><code class="language-makefile" data-lang="makefile"><span class="nv">MASMPATH</span><span class="o">=</span>F:<span class="se">\M</span>ASM32
<span class="nv">ML</span><span class="o">=</span>ml
<span class="nv">DEBUG</span> <span class="o">=</span> 1
<span class="err">!IF</span> <span class="nv">$(DEBUG)</span><span class="o">==</span>1
<span class="nv">CFLAGS</span><span class="o">=</span>/c /coff /Zd /Zi /Fl /Sn /nologo /I
<span class="err">!ELSE</span>
<span class="nv">CFLAGS</span><span class="o">=</span>/c /coff /Fl /Sn /nologo /I
<span class="err">!ENDIF</span>
<span class="nv">LDFLAGS</span><span class="o">=</span>
<span class="nv">SOURCES</span><span class="o">=</span>trans.asm
<span class="nv">OBJECTS</span><span class="o">=</span><span class="nv">$(SOURCES:.asm=.obj)</span>
<span class="nv">PROJ</span><span class="o">=</span>trans.exe


<span class="nl">$(PROJ)</span><span class="o">:</span> <span class="nf">$(OBJECTS)</span>
	<span class="nb">link</span> /NOLOGO /SUBSYSTEM:WINDOWS /LIBPATH:<span class="nv">$(MASMPATH)</span><span class="se">\L</span>IB <span class="nv">$(OBJECTS)</span>
	
<span class="nl">$(OBJECTS)</span><span class="o">:</span> <span class="nf">$(SOURCES)</span>
	<span class="nv">$(ML)</span> <span class="nv">$(CFLAGS)</span> <span class="nv">$(MASMPATH)</span><span class="se">\i</span>nclude <span class="nv">$(SOURCES)</span> 
	
<span class="nl">clean</span><span class="o">:</span>
	del <span class="k">*</span>.exe
	del <span class="k">*</span>.obj
	del <span class="k">*</span>.lst</code></pre></figure>

<ul>
  <li>A win32 Assembly program with the use of resources:</li>
</ul>

<figure class="highlight"><pre><code class="language-makefile" data-lang="makefile"><span class="nv">MASMPATH</span><span class="o">=</span>F:<span class="se">\M</span>ASM32
<span class="nv">ML</span><span class="o">=</span>ml
<span class="nv">DEBUG</span> <span class="o">=</span> 1
<span class="err">!IF</span> <span class="nv">$(DEBUG)</span><span class="o">==</span>1
<span class="nv">CFLAGS</span><span class="o">=</span>/c /coff /Zd /Zi /Fl /Sn /nologo /I
<span class="err">!ELSE</span>
<span class="nv">CFLAGS</span><span class="o">=</span>/c /coff /Fl /Sn /nologo /I
<span class="err">!ENDIF</span>
<span class="nv">LDFLAGS</span><span class="o">=</span>
<span class="nv">SOURCES</span><span class="o">=</span>vaoffset.asm
<span class="nv">RESOURCES</span><span class="o">=</span>vaoffset.rc
<span class="nv">OBJECTS</span><span class="o">=</span><span class="nv">$(SOURCES:.asm=.obj)</span> vaoffset.res
<span class="nv">PROJ</span><span class="o">=</span>vaoffset.exe


<span class="nl">$(PROJ)</span><span class="o">:</span> <span class="nf">$(OBJECTS)</span>
	<span class="nb">link</span> /NOLOGO /SUBSYSTEM:WINDOWS /LIBPATH:<span class="nv">$(MASMPATH)</span><span class="se">\L</span>IB /LIBPATH:f:<span class="se">\p</span>rojects<span class="se">\p</span>rograms<span class="se">\w</span>insock<span class="se">\n</span>etsend <span class="nv">$(OBJECTS)</span>
	
<span class="nl">$(OBJECTS)</span><span class="o">:</span> <span class="nf">$(SOURCES)</span>
	<span class="nv">$(ML)</span> <span class="nv">$(CFLAGS)</span> <span class="nv">$(MASMPATH)</span><span class="se">\i</span>nclude <span class="nv">$(SOURCES)</span> 
	C:<span class="se">\B</span>orland<span class="se">\B</span>CC55<span class="se">\B</span><span class="k">in</span><span class="se">\b</span>rcc32.exe vaoffset.rc
	
	
<span class="nl">clean</span><span class="o">:</span>
	del <span class="k">*</span>.exe
	del <span class="k">*</span>.obj
	del <span class="k">*</span>.lst
	</code></pre></figure>

<p>Now, Provided <strong>NMAKE</strong> is in your path variable, you can simply set a command in Notepad++ or in your favourite text editor to invoke nmake in current directory.</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">F:\projects\programs\WIN32ASM\transparent&gt;nmake /U

Microsoft (R) Program Maintenance Utility Version 10.00.30319.01
Copyright (C) Microsoft Corporation.  All rights reserved.

        ml /c /coff /Zd /Zi /Fl /Sn /nologo /I F:\MASM32\include trans.asm
 Assembling: trans.asm
        link /NOLOGO /SUBSYSTEM:WINDOWS /LIBPATH:F:\MASM32\LIB trans.obj</code></pre></figure>

<p>And to clean the output,</p>

<figure class="highlight"><pre><code class="language-text" data-lang="text">F:\projects\programs\WIN32ASM\transparent&gt;nmake clean

Microsoft (R) Program Maintenance Utility Version 10.00.30319.01
Copyright (C) Microsoft Corporation.  All rights reserved.

        del *.exe
        del *.obj
        del *.lst		</code></pre></figure>


			<footer>
				<div class="blocked tags">
					<p>
						
						<a href="/blog/tags/assembly">Assembly</a> |
						
						<a href="/blog/tags/masm">MASM</a> |
						
					</p>
				</div>
			</footer>

			<br />



			<div class="hr"></div>

		</article>

		<div class="c">&nbsp;</div>

	</div>


</section>

<div class="c">&nbsp;</div>

        </div>


        <footer id="footer" class="row">

            <p id="copyright">
                &copy; 2011-2026 Madhur Ahuja
            </p>
            <p id="poweredby" class="visible-lg visible-md">
                Powered by <a href="http://jekyllrb.com">Jekyll</a> and <a href="http://github.com/">Github</a>.
            </p>

            <div class="c">&nbsp;</div>


        </footer>


    </div>

    <script data-main="/files/js/app" src="/files/js/require.js"></script> 
    

    <!-- serviceWorker.html -->
    <script>
        if ('serviceWorker' in navigator) {

            navigator.serviceWorker.getRegistrations().then(function (registrations) {
                for (let registration of registrations) {
                    registration.unregister()
                }
            })
        }

// if ('serviceWorker' in navigator) {
//     navigator.serviceWorker.register('/serviceWorker.js').then(function(reg) {
//         if (!reg.installing) return;
//         console.log("[*] ServiceWorker is installing...");

//         var worker = reg.installing;
//         worker.addEventListener('statechange', function() {
//             if (worker.state == 'redundant') {
//                 console.log('[*] Install failed');
//             }
//             if (worker.state == 'installed') {
//                 console.log('[*] Install successful!');
//             }
//         });
//     });
// }

    </script>

</body>

</html>