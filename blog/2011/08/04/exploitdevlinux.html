<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8" /> 
    <title>Classic Buffer overflow exploits on Linux x64 &#8211; Madhur Ahuja</title>
    

    <meta name="author" content="Madhur Ahuja" />
    <meta name="description" content=" Classic Buffer overflow exploits on Linux x64" />

    <link rel="start" href="/" />

    <link rel="alternate" type="application/atom+xml" href="http://feeds.feedburner.com/madhur" title="RSS feed" />
    <link rel="shortcut icon" href="http://www.gravatar.com/avatar/5352cde0b084abcd6d4d783c08a51c76?s=16" />

    <link rel="stylesheet" href="/files/css/bootstrap.min.css" type="text/css" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="/files/font-awesome/css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="/files/css/jquery.fancybox.css" type="text/css" />

    <link rel="stylesheet" type="text/css" href="/files/css/styles.css" /> 
    <link rel="stylesheet" type="text/css" href="/files/css/syntax.css" /> 

     <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-N14VDHYFHQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-N14VDHYFHQ');
</script> 
    <link rel="stylesheet" type="text/css" media="print" href="/files/css/print.css"> 

    <script src="/files/js/vendor/pace.min.js" type="text/javascript"></script>
</head>


<body>

    <div class="container">

        <header id="header" class="row">

            <nav id="navigation" class="navbar navbar-inverse navbar-fixed-top " role="navigation">
    <div class="container">

    <div class="navbar-header">

     <div class="hidden-md hidden-sm hidden-lg searchli">

                <form method="get" role="search" id="searchform" action="/results" onsubmit="return checkfrm_search();">

                    <div class="form-group">
                        <input type="search" required id="q2" name="q" value="" class="form-control mobile" placeholder="Search" />
                    </div>
                </form>
        </div>

        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#mainmenu">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <!--  <a class="navbar-brand " href="/">Home</a> -->
    </div>

    <div class="collapse navbar-collapse" id="mainmenu">
        <ul id="nav" class="nav navbar-nav">
            
            <li><a class="home" href="/">Home</a>
            </li>
            <li><a class="blog" href="/blog">Blog</a>
            </li>
            <!--<li><a class="work" href="/work">Resume</a></li>-->
            <li><a class="code" href="/projects">Work</a>
            </li>
            <!--<li><a class="papers" href="/papers">Papers</a></li>-->
            <li><a class="info" href="/info">About</a>
            </li>
            <li><a class="contact" href="/contact">Contact</a>
            </li>

        </ul>

        <ul class="nav navbar-nav visible-md visible-lg visible-sm searchbox">
            <li>
                <form method="get" role="search" id="searchform" action="/results" onsubmit="return checkfrm_search();">

                    <div class="form-group">
                        <input type="search" required id="q1" name="q" value="" class="form-control desktop" placeholder="Search" />
                    </div>
                </form>
            </li>
        </ul>


        <ul class="nav-icons navbar-right nav navbar-nav visible-md visible-lg">
            <li><a href="http://www.linkedin.com/in/madhurahuja"><i class="fa fa-linkedin-square fa-3x"></i></a>
            </li>
            <li><a href="https://github.com/madhur"><i class="fa fa-github fa-3x"></i></a>
            </li>
            <li><a href="http://feeds.feedburner.com/madhur"><i class="fa fa-rss-square fa-3x"></i></a>
            </li>
        </ul>


    </div>

</div>
</nav>


        </header>

        <div id="content" class="row">

            <section>

	<div id="blogcontent">

		<!--<aside class="postmeta col-md-3 hidden-print visible-md visible-lg">

			

		</aside>-->

		<article id="blog-article" class="post col-md-12 clearfix">

				<header><h1>Classic Buffer overflow exploits on Linux x64</h1></header>
			
					<!-- Place this tag where you want the +1 button to render -->
<div class="row social hidden-xs">
    <div class="col-md-2 col-sm-2">
        <time datetime="2011-08-04 00:00:00 +0530" pubdate="pubdate"
            >04 August 2011</time
        >
    </div>
    <div class="social-icon col-md-2 col-sm-2">
       <a href="https://twitter.com/madhur25?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-show-count="false">Follow @madhur25</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    </div>
    <div class="social-icon col-md-1 col-sm-2">
        <a
            href="https://twitter.com/share?ref_src=twsrc%5Etfw"
            class="twitter-share-button"
            data-via="madhur25"
            data-show-count="false"
            >Tweet</a
        >
        <script
            async
            src="https://platform.twitter.com/widgets.js"
            charset="utf-8"
        ></script>
    </div>
    <div class="social-icon col-md-1 col-sm-2">
        <script src="https://platform.linkedin.com/in.js" type="text/javascript">lang: en_US</script>
        <script type="IN/Share" data-counter="right"></script>
    </div>

    <!-- <div class="social-icon col-md-1 col-sm-2">
        <a
            href="http://bufferapp.com/add"
            class="buffer-add-button"
            data-count="horizontal"
            >Buffer</a
        >
        <script
            type="text/javascript"
            src="https://d389zggrogs7qo.cloudfront.net/js/button.js"
        ></script>
    </div> -->
    <div class="social-icon col-md-1 col-sm-2">
        <a
            data-pocket-label="pocket"
            data-pocket-count="horizontal"
            class="pocket-btn"
            data-lang="en"
        ></a>
        <script type="text/javascript">
            !(function (d, i) {
                if (!d.getElementById(i)) {
                    var j = d.createElement("script");
                    j.id = i;
                    j.src = "https://widgets.getpocket.com/v1/j/btn.js?v=1";
                    var w = d.getElementById(i);
                    d.body.appendChild(j);
                }
            })(document, "pocket-btn-js");
        </script>
    </div>
    <!-- <div class="social-icon col-md-2 col-sm-2">
        <script
            type="text/javascript"
            src="//www.redditstatic.com/button/button1.js"
        ></script>
    </div> -->
</div>


			<hr style="margin-top:0px" />


			 <p>If you are learning buffer overflow exploit development on Linux x64 machine, then there are something which you need to take care of.</p>

<p>This is because architecture and execution of programs in x64 machine model is completely different from x32 machine model.</p>

<p>For a reference to stack frame in x64, refer to this <a href="http://analyze-v.com/?p=468">link</a></p>

<p>Consider this C program and I will demonstrate the effect of compiling this program for x32 and x64.</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="cp">#include &lt;stdio.h&gt;
#include &lt;string.h&gt;
</span>
<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
	<span class="kt">char</span> <span class="n">buffer</span><span class="p">[</span><span class="mi">500</span><span class="p">];</span>
	<span class="n">strcpy</span><span class="p">(</span><span class="n">buffer</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>  <span class="c1">//vulnerable function</span>
	
	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span></code></pre></figure>

<p>If you are on x64, simply executing this command will compile it for x64</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">gcc</span> <span class="o">-</span><span class="n">ggdb</span> <span class="o">-</span><span class="n">m64</span> <span class="o">-</span><span class="n">o</span> <span class="n">buffer1</span> <span class="o">-</span><span class="n">fno</span><span class="o">-</span><span class="n">stack</span><span class="o">-</span><span class="n">protector</span> <span class="o">-</span><span class="n">mpreferred</span><span class="o">-</span><span class="n">stack</span><span class="o">-</span><span class="n">boundary</span><span class="o">=</span><span class="mi">4</span> <span class="n">buffer1</span><span class="p">.</span><span class="n">c</span></code></pre></figure>

<p>And this one for x32</p>

<figure class="highlight"><pre><code class="language-c" data-lang="c"><span class="n">gcc</span> <span class="o">-</span><span class="n">ggdb</span> <span class="o">-</span><span class="n">m32</span> <span class="o">-</span><span class="n">o</span> <span class="n">buffer1</span> <span class="o">-</span><span class="n">fno</span><span class="o">-</span><span class="n">stack</span><span class="o">-</span><span class="n">protector</span> <span class="o">-</span><span class="n">mpreferred</span><span class="o">-</span><span class="n">stack</span><span class="o">-</span><span class="n">boundary</span><span class="o">=</span><span class="mi">4</span> <span class="n">buffer1</span><span class="p">.</span><span class="n">c</span></code></pre></figure>

<p>Let’s try to exploit this buffer overflow vulnerability using gdb on both the versions. Here are the outputs</p>

<p>x64</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">madhur@bt:~/buffer<span class="nv">$ </span>gdb buffer1
GNU gdb <span class="o">(</span>GDB<span class="o">)</span> 7.1-ubuntu
Copyright <span class="o">(</span>C<span class="o">)</span> 2010 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type <span class="s2">"show copying"</span>
and <span class="s2">"show warranty"</span> <span class="k">for </span>details.
This GDB was configured as <span class="s2">"x86_64-linux-gnu"</span><span class="nb">.</span>
For bug reporting instructions, please see:
&lt;http://www.gnu.org/software/gdb/bugs/&gt;...
Reading symbols from /home/madhur/buffer/buffer1...done.
<span class="o">(</span>gdb<span class="o">)</span> run <span class="si">$(</span>python <span class="nt">-c</span> <span class="s1">'print "\x41" * 1500'</span><span class="si">)</span>
Starting program: /home/madhur/buffer/buffer1 <span class="si">$(</span>python <span class="nt">-c</span> <span class="s1">'print "\x41" * 1500'</span><span class="si">)</span>

Program received signal SIGSEGV, Segmentation fault.
0x0000000000400565 <span class="k">in </span>main <span class="o">(</span><span class="nv">argc</span><span class="o">=</span>Cannot access memory at address 0x4141414141413f3d
<span class="o">)</span> at buffer1.c:10
10	<span class="o">}</span>
<span class="o">(</span>gdb<span class="o">)</span> info registers
rax            0x0	0
rbx            0x0	0
rcx            0x41414141414141	18367622009667905
rdx            0x1000	4096
rsi            0x7fffffffe769	140737488349033
rdi            0x7fffffffe1f0	140737488347632
rbp            0x4141414141414141	0x4141414141414141
rsp            0x7fffffffde28	0x7fffffffde28
r8             0x7ffff7dd8300	140737351877376
r9             0x5c0	1472
r10            0x7	7
r11            0x7ffff7ba92a0	140737349587616
r12            0x400440	4195392
r13            0x7fffffffdf00	140737488346880
r14            0x0	0
r15            0x0	0
rip            0x400565	0x400565 &lt;main+65&gt;
eflags         0x10206	<span class="o">[</span> PF IF RF <span class="o">]</span>
cs             0x33	51
ss             0x2b	43
ds             0x0	0
es             0x0	0
fs             0x0	0</code></pre></figure>

<p>x32</p>

<figure class="highlight"><pre><code class="language-bash" data-lang="bash">madhur@bt:~/buffer<span class="nv">$ </span>gdb buffer1
GNU gdb <span class="o">(</span>GDB<span class="o">)</span> 7.1-ubuntu
Copyright <span class="o">(</span>C<span class="o">)</span> 2010 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type <span class="s2">"show copying"</span>
and <span class="s2">"show warranty"</span> <span class="k">for </span>details.
This GDB was configured as <span class="s2">"x86_64-linux-gnu"</span><span class="nb">.</span>
For bug reporting instructions, please see:
&lt;http://www.gnu.org/software/gdb/bugs/&gt;...
Reading symbols from /home/madhur/buffer/buffer1...done.
<span class="o">(</span>gdb<span class="o">)</span> run <span class="si">$(</span>python <span class="nt">-c</span> <span class="s1">'print "\x41" * 1500'</span><span class="si">)</span>
Starting program: /home/madhur/buffer/buffer1 <span class="si">$(</span>python <span class="nt">-c</span> <span class="s1">'print "\x41" * 1500'</span><span class="si">)</span>
warning: the debug information found <span class="k">in</span> <span class="s2">"/lib/ld-2.11.1.so"</span> does not match <span class="s2">"/lib/ld-linux.so.2"</span> <span class="o">(</span>CRC mismatch<span class="o">)</span><span class="nb">.</span>


Program received signal SIGSEGV, Segmentation fault.
0x41414141 <span class="k">in</span> ?? <span class="o">()</span>
<span class="o">(</span>gdb<span class="o">)</span> info registers
eax            0x0	0
ecx            0x0	0
edx            0x5dd	1501
ebx            0xf7fbdff4	<span class="nt">-134488076</span>
esp            0xffffcf80	0xffffcf80
ebp            0x41414141	0x41414141
esi            0x0	0
edi            0x0	0
eip            0x41414141	0x41414141
eflags         0x10246	<span class="o">[</span> PF ZF IF RF <span class="o">]</span>
cs             0x23	35
ss             0x2b	43
ds             0x2b	43
es             0x2b	43
fs             0x0	0
gs             0x63	99
<span class="o">(</span>gdb<span class="o">)</span> </code></pre></figure>

<p>As you can see in the outputs above, there is no EIP register in x64 version of program. And in the x32 version, the EIP value is correctly corrupted with our overflowed value of x41.</p>


			<footer>
				<div class="blocked tags">
					<p>
					
						<a href="/blog/tags/security">Security</a> |
					
						<a href="/blog/tags/exploits">Exploits</a> |
					
					</p>
				</div>
			</footer>
			
			<br/>
		
			
			
			<div class="hr"></div>

		


			<!-- Discus Comments -->
			<div id="disqus_thread"></div>

			
			<!-- Enable Disqus comments -->
			<script type="text/javascript">
  var disqus_developer = 0; // developer mode is on
  var disqus_shortname = 'madhur';
  var disqus_identifier = '/2011/08/04/exploitdevlinux/';
  var disqus_title = 'Classic Buffer overflow exploits on Linux x64';
  var disqus_url = 'https://madhur.co.in/blog/2011/08/04/exploitdevlinux.html';
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();

</script>

			
			
			
			

		</article>

		<div class="c">&nbsp;</div>

	</div>

	
</section>
 
<div class="c">&nbsp;</div>


  

 

 



        </div>


        <footer id="footer" class="row">

            <p id="copyright">
                &copy; 2011-2024 Madhur Ahuja
            </p>
            <p id="poweredby" class="visible-lg visible-md">
                Powered by
                <a href="http://jekyllrb.com" title="A static, minimalist CMS">Jekyll</a>,
                <a href="http://github.com/">Github</a> and
                <a href="http://disqus.com">Disqus</a>.
            </p>

            <div class="c">&nbsp;</div>


        </footer>


    </div>

    <script data-main="/files/js/app" src="/files/js/require.js"></script> 
    

    <!-- serviceWorker.html -->
    <script>
        if ('serviceWorker' in navigator) {

            navigator.serviceWorker.getRegistrations().then(function (registrations) {
                for (let registration of registrations) {
                    registration.unregister()
                }
            })
        }

// if ('serviceWorker' in navigator) {
//     navigator.serviceWorker.register('/serviceWorker.js').then(function(reg) {
//         if (!reg.installing) return;
//         console.log("[*] ServiceWorker is installing...");

//         var worker = reg.installing;
//         worker.addEventListener('statechange', function() {
//             if (worker.state == 'redundant') {
//                 console.log('[*] Install failed');
//             }
//             if (worker.state == 'installed') {
//                 console.log('[*] Install successful!');
//             }
//         });
//     });
// }

    </script>

</body>

</html>