<!DOCTYPE html>

<html lang="en">
<head>
   <meta charset="utf-8" />
   <title>Classic Buffer overflow exploits on Linux x64 &#8211; Madhur Ahuja</title>
   <meta name="author" content="Madhur Ahuja" />
   
    
		<meta name="description" content=" Classic Buffer overflow exploits on Linux x64" />
	

    <link rel="start" href="/" />

	
	
  	<link rel="alternate" type="application/atom+xml" href="http://feeds.feedburner.com/madhur" title="RSS feed" />
	<link rel="shortcut icon" href="http://www.gravatar.com/avatar/5352cde0b084abcd6d4d783c08a51c76?s=16" />
   
	<link rel="stylesheet" href="/files/css/blueprint/screen.css" type="text/css" />   	
	<link rel="stylesheet" href="/files/css/disqus-form.css" type="text/css" />   	
	<link rel="stylesheet" href="/files/css/site.css" type="text/css" />
	<link rel="stylesheet" href="/files/css/syntax.css" type="text/css" />
	<link rel="stylesheet" href="/files/font-awesome/css/font-awesome.min.css" type="text/css" />
	<link rel="stylesheet" href="/files/css/jquery.fancybox.css" type="text/css" />
	
	
			
   <link rel="stylesheet" type="text/css" media="print" href="/files/css/print.css">
   
   
	<script src="/files/js/jquery.js" type="text/javascript"></script>	
	<script src="/files/js/jquery.fancybox.pack.js" type="text/javascript"></script>
	
	<!--[if lt IE 9]>
		<script src="/files/js/modernizr-2.5.3.js" type="text/javascript"></script>
	<![endif]-->
	
	<script type="text/javascript">
	var disqus_iframe_css = 'http://madhur.co.in/files/css/disqus-form.css';
	</script>
	
	
	<script src="/files/js/URI.js" type="text/javascript"></script>
	<script src="/files/js/site.js" type="text/javascript"></script>
	
	<script type="text/javascript">
	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-23769089-1']);
	  _gaq.push(['_trackPageview']);

	  (function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();

	</script>
		
	
</head>
<body>
<div id="gradient">
	<div id="container" class="container">
		<header id="header" class="span-24 last">

			<div id="logo">
<ul>
<li><a href="http://www.linkedin.com/in/madhurahuja"><img src="/images/linkedinhigh.png" /></a></li>
<li><a href="https://github.com/madhur"><img src="/images/github_32.png"/></a></li>
<li><a href="http://feeds.feedburner.com/madhur"><img src="/images/rsshigh.png" /></a></li>
</ul>
</div>


<nav id="navigation">
				<ul id="nav">
					<li><a class="madhur" href="/">Madhur Ahuja</a></li>
					<li><a class="home" href="/">Home</a></li>
					<li><a class="blog" href="/blogindex.html">Blog</a></li>
					<!--<li><a class="work" href="/work">Resume</a></li>-->
					<li><a class="code" href="/projects">Projects</a></li>
					<li><a class="papers" href="/papers">Papers</a></li>
					<li><a class="info" href="/info">About</a></li>
					<li><a class="contact" href="/contact">Contact</a></li>

				</ul>
				
				
</nav>
<div class="c">
&nbsp;
</div>





		</header>
		<div id="content" class="span-24 last">

			<section id="primary" class="span-24 last">

	<div id="blogcontent">

		<aside class="postmeta full span-5">

			<div class="timestamp">
	<time datetime="2011-08-04 00:00:00 +0530" pubdate="pubdate">04 August 2011</time>

	<br>
	<span pubdate="pubdate" class="time">8:00 PM</span>
</div> 

<div class="actions">
<ul> 
								<li><a href="/blog/2011/08/04/exploitdevlinux.html#disqus_thread" data-disqus-identifier="/2011/08/04/exploitdevlinux/" class="comment">View Comments</a></li> 

<script type="text/javascript">

	var disqus_developer = 0;
		var disqus_shortname = 'madhur';
		var disqus_iframe_css = "http://madhur.github.com/css/screen.css";
			var links = document.getElementsByTagName('a');
			var query = '?';
			
					query += 'url=' + encodeURIComponent(window.location.href) + '&';
					//alert(query);
				
			
	document.write('<script type="text/javascript" src="http://disqus.com/forums/madhur/get_num_replies.js?url2=' + encodeURIComponent(window.location.url) + '#disqus_thread"></' + 'script>');
	

</script>


								<li><span class="share" title="Click to expand">share this post</span> 
									<ul class="sharing" style="display:none"> 
										<li class="first"><a href="http://blinklist.com/index.php?Action=Blink/addblink.php&amp;Url=/blog/2011/08/04/exploitdevlinux.html&amp;Title=Classic Buffer overflow exploits on Linux x64" id="share_blinklist" title="Share on BlinkList" rel="nofollow">BlinkList</a></li> 
										<li><a href="http://del.icio.us/post?url=http://madhur.co.in/blog/2011/08/04/exploitdevlinux.html&amp;title=Classic Buffer overflow exploits on Linux x64" id="share_delicious" title="Add to del.icio.us" rel="nofollow">del.icio.us</a></li> 
										<li><a href="http://digg.com/submit?url=http://madhur.co.in/blog/2011/08/04/exploitdevlinux.html" id="share_digg" title="Digg This!" rel="nofollow">Digg</a></li> 
										<li><a href="http://www.facebook.com/share.php?u=http://madhur.co.in/blog/2011/08/04/exploitdevlinux.html" id="share_facebook" title="Share on Facebook" rel="nofollow">Facebook</a></li> 
										<li><a href="http://reddit.com/submit?url=http://madhur.co.in/blog/2011/08/04/exploitdevlinux.html&amp;title=Classic Buffer overflow exploits on Linux x64" id="share_reddit" title="Share on Reddit" rel="nofollow">Reddit</a></li> 
										<li><a href="http://www.stumbleupon.com/submit?url=http://madhur.co.in/blog/2011/08/04/exploitdevlinux.html&amp;title=Classic Buffer overflow exploits on Linux x64" id="share_stumbleupon" title="Share on StumbleUpon" rel="nofollow">StumbleUpon</a></li> 
										<li><a href="http://twitter.com/home?status=http://madhur.co.inClassic Buffer overflow exploits on Linux x64%3A%20/blog/2011/08/04/exploitdevlinux.html" id="share_twitter" title="Tweet this!" rel="nofollow">Twitter</a></li> 
										<li class="last"><a href="http://www.technorati.com/faves?add=http://madhur.co.in/blog/2011/08/04/exploitdevlinux.html" id="share_technorati" title="Favourite on Technorati" rel="nofollow">Technorati</a></li> 
									</ul> 
								</li> 
								<li><a href="http://feeds.feedburner.com/madhur" class="subscribe">subscribe to this blog</a></li> 
								
								<li><a href="javascript:Clickheretoprint()" class="subscribe">print this page</a></li> 								
								<li><a href="/blog/2011/08/04/exploitdevlinux.html" class="permalink">permalink</a></li> 
															</ul> 

</div>

<div class="category">
<h3>Advert</h3>
	<script type="text/javascript"><!--
google_ad_client = "ca-pub-1657163894706869";
/* madhur.co.in right side */
google_ad_slot = "3156850124";
google_ad_width = 160;
google_ad_height = 600;
//-->
</script>
<script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script>


</div>


		</aside>

		<article class="post full span-18 last">
					<header><h1>Classic Buffer overflow exploits on Linux x64</h1></header>
			 <p>If you are learning buffer overflow exploit development on Linux x64 machine, then there are something which you need to take care of.</p>

<p>This is because architecture and execution of programs in x64 machine model is completely different from x32 machine model.</p>

<p>For a reference to stack frame in x64, refer to this <a href='http://analyze-v.com/?p=468'>link</a></p>

<p>Consider this C program and I will demonstrate the effect of compiling this program for x32 and x64.</p>
<div class='highlight'><pre><code class='c'><span class='cp'>#include &lt;stdio.h&gt;</span>
<span class='cp'>#include &lt;string.h&gt;</span>

<span class='kt'>int</span> <span class='nf'>main</span><span class='p'>(</span><span class='kt'>int</span> <span class='n'>argc</span><span class='p'>,</span> <span class='kt'>char</span> <span class='o'>**</span><span class='n'>argv</span><span class='p'>)</span>
<span class='p'>{</span>
	<span class='kt'>char</span> <span class='n'>buffer</span><span class='p'>[</span><span class='mi'>500</span><span class='p'>];</span>
	<span class='n'>strcpy</span><span class='p'>(</span><span class='n'>buffer</span><span class='p'>,</span> <span class='n'>argv</span><span class='p'>[</span><span class='mi'>1</span><span class='p'>]);</span>  <span class='c1'>//vulnerable function</span>
	
	<span class='k'>return</span> <span class='mi'>0</span><span class='p'>;</span>
<span class='p'>}</span>
</code></pre></div>
<p>If you are on x64, simply executing this command will compile it for x64</p>
<div class='highlight'><pre><code class='c'><span class='n'>gcc</span> <span class='o'>-</span><span class='n'>ggdb</span> <span class='o'>-</span><span class='n'>m64</span> <span class='o'>-</span><span class='n'>o</span> <span class='n'>buffer1</span> <span class='o'>-</span><span class='n'>fno</span><span class='o'>-</span><span class='n'>stack</span><span class='o'>-</span><span class='n'>protector</span> <span class='o'>-</span><span class='n'>mpreferred</span><span class='o'>-</span><span class='n'>stack</span><span class='o'>-</span><span class='n'>boundary</span><span class='o'>=</span><span class='mi'>4</span> <span class='n'>buffer1</span><span class='p'>.</span><span class='n'>c</span>
</code></pre></div>
<p>And this one for x32</p>
<div class='highlight'><pre><code class='c'><span class='n'>gcc</span> <span class='o'>-</span><span class='n'>ggdb</span> <span class='o'>-</span><span class='n'>m32</span> <span class='o'>-</span><span class='n'>o</span> <span class='n'>buffer1</span> <span class='o'>-</span><span class='n'>fno</span><span class='o'>-</span><span class='n'>stack</span><span class='o'>-</span><span class='n'>protector</span> <span class='o'>-</span><span class='n'>mpreferred</span><span class='o'>-</span><span class='n'>stack</span><span class='o'>-</span><span class='n'>boundary</span><span class='o'>=</span><span class='mi'>4</span> <span class='n'>buffer1</span><span class='p'>.</span><span class='n'>c</span>
</code></pre></div>
<p>Let&#8217;s try to exploit this buffer overflow vulnerability using gdb on both the versions. Here are the outputs</p>

<p>x64:</p>
<div class='highlight'><pre><code class='bash'>madhur@bt:~/buffer<span class='nv'>$ </span>gdb buffer1
GNU gdb <span class='o'>(</span>GDB<span class='o'>)</span> 7.1-ubuntu
Copyright <span class='o'>(</span>C<span class='o'>)</span> 2010 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type <span class='s2'>&quot;show copying&quot;</span>
and <span class='s2'>&quot;show warranty&quot;</span> <span class='k'>for </span>details.
This GDB was configured as <span class='s2'>&quot;x86_64-linux-gnu&quot;</span>.
For bug reporting instructions, please see:
&lt;http://www.gnu.org/software/gdb/bugs/&gt;...
Reading symbols from /home/madhur/buffer/buffer1...done.
<span class='o'>(</span>gdb<span class='o'>)</span> run <span class='k'>$(</span>python -c <span class='s1'>&#39;print &quot;\x41&quot; * 1500&#39;</span><span class='k'>)</span>
Starting program: /home/madhur/buffer/buffer1 <span class='k'>$(</span>python -c <span class='s1'>&#39;print &quot;\x41&quot; * 1500&#39;</span><span class='k'>)</span>

Program received signal SIGSEGV, Segmentation fault.
0x0000000000400565 in main <span class='o'>(</span><span class='nv'>argc</span><span class='o'>=</span>Cannot access memory at address 0x4141414141413f3d
<span class='o'>)</span> at buffer1.c:10
10	<span class='o'>}</span>
<span class='o'>(</span>gdb<span class='o'>)</span> info registers
rax            0x0	0
rbx            0x0	0
rcx            0x41414141414141	18367622009667905
rdx            0x1000	4096
rsi            0x7fffffffe769	140737488349033
rdi            0x7fffffffe1f0	140737488347632
rbp            0x4141414141414141	0x4141414141414141
rsp            0x7fffffffde28	0x7fffffffde28
r8             0x7ffff7dd8300	140737351877376
r9             0x5c0	1472
r10            0x7	7
r11            0x7ffff7ba92a0	140737349587616
r12            0x400440	4195392
r13            0x7fffffffdf00	140737488346880
r14            0x0	0
r15            0x0	0
rip            0x400565	0x400565 &lt;main+65&gt;
eflags         0x10206	<span class='o'>[</span> PF IF RF <span class='o'>]</span>
cs             0x33	51
ss             0x2b	43
ds             0x0	0
es             0x0	0
fs             0x0	0
</code></pre></div>
<p>x32:</p>
<div class='highlight'><pre><code class='bash'>madhur@bt:~/buffer<span class='nv'>$ </span>gdb buffer1
GNU gdb <span class='o'>(</span>GDB<span class='o'>)</span> 7.1-ubuntu
Copyright <span class='o'>(</span>C<span class='o'>)</span> 2010 Free Software Foundation, Inc.
License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.  Type <span class='s2'>&quot;show copying&quot;</span>
and <span class='s2'>&quot;show warranty&quot;</span> <span class='k'>for </span>details.
This GDB was configured as <span class='s2'>&quot;x86_64-linux-gnu&quot;</span>.
For bug reporting instructions, please see:
&lt;http://www.gnu.org/software/gdb/bugs/&gt;...
Reading symbols from /home/madhur/buffer/buffer1...done.
<span class='o'>(</span>gdb<span class='o'>)</span> run <span class='k'>$(</span>python -c <span class='s1'>&#39;print &quot;\x41&quot; * 1500&#39;</span><span class='k'>)</span>
Starting program: /home/madhur/buffer/buffer1 <span class='k'>$(</span>python -c <span class='s1'>&#39;print &quot;\x41&quot; * 1500&#39;</span><span class='k'>)</span>
warning: the debug information found in <span class='s2'>&quot;/lib/ld-2.11.1.so&quot;</span> does not match <span class='s2'>&quot;/lib/ld-linux.so.2&quot;</span> <span class='o'>(</span>CRC mismatch<span class='o'>)</span>.


Program received signal SIGSEGV, Segmentation fault.
0x41414141 in ?? <span class='o'>()</span>
<span class='o'>(</span>gdb<span class='o'>)</span> info registers
eax            0x0	0
ecx            0x0	0
edx            0x5dd	1501
ebx            0xf7fbdff4	-134488076
esp            0xffffcf80	0xffffcf80
ebp            0x41414141	0x41414141
esi            0x0	0
edi            0x0	0
eip            0x41414141	0x41414141
eflags         0x10246	<span class='o'>[</span> PF ZF IF RF <span class='o'>]</span>
cs             0x23	35
ss             0x2b	43
ds             0x2b	43
es             0x2b	43
fs             0x0	0
gs             0x63	99
<span class='o'>(</span>gdb<span class='o'>)</span> 
</code></pre></div>
<p>As you can see in the outputs above, there is no EIP register in x64 version of program. And in the x32 version, the EIP value is correctly corrupted with our overflowed value of x41.</p>
			<footer>
				<div class="blocked tags">
					<p>
					
						<a href="/tags/security">Security</a> |
					
						<a href="/tags/exploits">Exploits</a> |
					
					</p>
				</div>
			</footer>
			<div class="hr"></div>

			<div>


				<!-- Enable Google Plus comments -->
				<!-- Place this tag where you want the +1 button to render -->
<div class="social">
<g:plusone></g:plusone>
<fb:like href="http://madhur.co.in/blog/2011/08/04/exploitdevlinux.html" send="true" layout="button_count" width="450" show_faces="true" colorscheme="dark" font="lucida grande"></fb:like>
</div>


<!-- Place this tag after the last plusone tag -->
<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>


			</div>


			<!-- Discus Comments -->
			<div id="disqus_thread"></div>

			
			<!-- Enable Disqus comments -->
			<script type="text/javascript">
  var disqus_developer = 0; // developer mode is on
  var disqus_shortname = 'madhur';
  var disqus_identifier = '/2011/08/04/exploitdevlinux/';
  var disqus_title = 'Classic Buffer overflow exploits on Linux x64';
  var disqus_url = 'http://madhur.co.in/blog/2011/08/04/exploitdevlinux.html';
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();

</script>

			
			
			

		</article>

		<div class="c">&nbsp;</div>

	</div>

	
</section>
 
<div class="c">&nbsp;</div>


  
<script type="text/javascript">
    
    var disqus_shortname = 'madhur'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

 

 



		</div>
		  
		<footer id="footer" class="span-24 last">
			
				<p id="copyright">
					Content &amp; Design by 
					<a href="/info/">Madhur Ahuja</a>
					&copy; 2010-2013
					(Some rights reserved)			
				</p>
				<p id="poweredby">
					Powered by 
					<a href="http://jekyllrb.com" title="A static, minimalist CMS">Jekyll 1.2.1</a> and <a href="http://disqus.com">Disqus</a>.
				</p>

				<div class="c">&nbsp;</div>

			
		</footer>

	</div>

</div>

</body>
</html>
