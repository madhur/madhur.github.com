<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8" /> 
    <title>Ensuring git commit messages contain JIRA ID &#8211; Madhur Ahuja</title>
    

    <meta name="author" content="Madhur Ahuja" />
    <meta name="description" content=" Ensuring git commit messages contain JIRA ID" />

    <link rel="start" href="/" />

    <link rel="alternate" type="application/atom+xml" href="http://feeds.feedburner.com/madhur" title="RSS feed" />
    <link rel="shortcut icon" href="http://www.gravatar.com/avatar/5352cde0b084abcd6d4d783c08a51c76?s=16" />

    <link rel="stylesheet" href="/files/css/bootstrap.min.css" type="text/css" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="/files/font-awesome/css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="/files/css/jquery.fancybox.css" type="text/css" />

    <link rel="stylesheet" type="text/css" href="/files/css/styles.css" /> 
    <link rel="stylesheet" type="text/css" href="/files/css/syntax.css" /> 

    <link rel="stylesheet" type="text/css" media="print" href="/files/css/print.css"> 

    <script src="/files/js/vendor/pace.min.js" type="text/javascript"></script>
</head>

<body>

    <div class="container">

        <header id="header" class="row">

            <nav id="navigation" class="navbar navbar-inverse navbar-fixed-top " role="navigation">
    <div class="container">

    <div class="navbar-header">

     <div class="hidden-md hidden-sm hidden-lg searchli">

                <form method="get" role="search" id="searchform" action="/results" onsubmit="return checkfrm_search();">

                    <div class="form-group">
                        <input type="search" required id="q2" name="q" value="" class="form-control mobile" placeholder="Search" />
                    </div>
                </form>
        </div>

        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#mainmenu">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <!--  <a class="navbar-brand " href="/">Home</a> -->
    </div>

    <div class="collapse navbar-collapse" id="mainmenu">
        <ul id="nav" class="nav navbar-nav">
            
            <li><a class="home" href="/">Home</a>
            </li>
            <li><a class="blog" href="/blog">Blog</a>
            </li>
            <!--<li><a class="work" href="/work">Resume</a></li>-->
            <li><a class="code" href="/projects">Work</a>
            </li>
            <!--<li><a class="papers" href="/papers">Papers</a></li>-->
            <li><a class="info" href="/info">About</a>
            </li>
            <li><a class="contact" href="/contact">Contact</a>
            </li>

        </ul>

        <ul class="nav navbar-nav visible-md visible-lg visible-sm searchbox">
            <li>
                <form method="get" role="search" id="searchform" action="/results" onsubmit="return checkfrm_search();">

                    <div class="form-group">
                        <input type="search" required id="q1" name="q" value="" class="form-control desktop" placeholder="Search" />
                    </div>
                </form>
            </li>
        </ul>


        <ul class="nav-icons navbar-right nav navbar-nav visible-md visible-lg">
            <li><a href="http://www.linkedin.com/in/madhurahuja"><i class="fa fa-linkedin-square fa-3x"></i></a>
            </li>
            <li><a href="https://github.com/madhur"><i class="fa fa-github fa-3x"></i></a>
            </li>
            <li><a href="http://feeds.feedburner.com/madhur"><i class="fa fa-rss-square fa-3x"></i></a>
            </li>
        </ul>


    </div>

</div>
</nav>


        </header>

        <div id="content" class="row">

            <section>

	<div id="blogcontent">

		<!--<aside class="postmeta col-md-3 hidden-print visible-md visible-lg">

			

		</aside>-->

		<article id="blog-article" class="post col-md-12 clearfix">

				<header><h1>Ensuring git commit messages contain JIRA ID</h1></header>
			
					<!-- Place this tag where you want the +1 button to render -->
<div class="row social hidden-xs">
    <div class="col-md-2 col-sm-2">
        <time datetime="2020-01-12 00:00:00 +0530" pubdate="pubdate"
            >12 January 2020</time
        >
    </div>
    <div class="social-icon col-md-2 col-sm-2">
       <a href="https://twitter.com/madhur25?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-show-count="false">Follow @madhur25</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    </div>
    <div class="social-icon col-md-1 col-sm-2">
        <a
            href="https://twitter.com/share?ref_src=twsrc%5Etfw"
            class="twitter-share-button"
            data-via="madhur25"
            data-show-count="false"
            >Tweet</a
        >
        <script
            async
            src="https://platform.twitter.com/widgets.js"
            charset="utf-8"
        ></script>
    </div>
    <div class="social-icon col-md-1 col-sm-2">
        <script src="https://platform.linkedin.com/in.js" type="text/javascript">lang: en_US</script>
        <script type="IN/Share" data-counter="right"></script>
    </div>

    <!-- <div class="social-icon col-md-1 col-sm-2">
        <a
            href="http://bufferapp.com/add"
            class="buffer-add-button"
            data-count="horizontal"
            >Buffer</a
        >
        <script
            type="text/javascript"
            src="https://d389zggrogs7qo.cloudfront.net/js/button.js"
        ></script>
    </div> -->
    <div class="social-icon col-md-1 col-sm-2">
        <a
            data-pocket-label="pocket"
            data-pocket-count="horizontal"
            class="pocket-btn"
            data-lang="en"
        ></a>
        <script type="text/javascript">
            !(function (d, i) {
                if (!d.getElementById(i)) {
                    var j = d.createElement("script");
                    j.id = i;
                    j.src = "https://widgets.getpocket.com/v1/j/btn.js?v=1";
                    var w = d.getElementById(i);
                    d.body.appendChild(j);
                }
            })(document, "pocket-btn-js");
        </script>
    </div>
    <!-- <div class="social-icon col-md-2 col-sm-2">
        <script
            type="text/javascript"
            src="//www.redditstatic.com/button/button1.js"
        ></script>
    </div> -->
</div>


			<hr style="margin-top:0px" />


			 <p>Recently, we implemented a policy where every commit message includes the JIRA ID from the committer. This makes sure that every change to repo is tagged against either a user story or an issue which helps in traceability. Initially, it was difficult and users used to forget it. We had a github hook which would validate the commit message and reject the updates to the remote repo. Users would then amend the commmit using
<code class="highlighter-rouge">git commit --amend</code> or even <code class="highlighter-rouge">git rebase -i HEAD~n</code> if there are multiple commits to be amended.</p>

<p>Fortunately, there is a provision in git itself which can validate your commit message in the local repo itself. All you to have to do is make a copy of  <code class="highlighter-rouge">.git/prepare-commit-msg.sample</code> to <code class="highlighter-rouge">.git/prepare-commit-msg</code> and then include your logic there. We used a convention that users create branch name with JIRA ID itself and this script can pickup the JIRA ID from the branch name itself. In the worst case, while working with branches such as <code class="highlighter-rouge">staging</code>, <code class="highlighter-rouge">master</code>, <code class="highlighter-rouge">release</code> etc, the users can provide the JIRA ID in the commit message. If there is no JIRA ID provided, the commit will be aborted with an error.</p>

<p>Below is the snippet I used, written in ruby</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#!/usr/bin/env ruby</span>

<span class="c1"># Git Prepare Commit Message Hook Script</span>
<span class="c1">#</span>
<span class="c1"># Location: &lt;repository&gt;/.git/hooks/prepare-commit-msg</span>
<span class="c1">#</span>
<span class="c1"># This script will automatically add the correct</span>
<span class="c1"># JIRA ISSUE ID to the end of each commit message</span>
<span class="c1"># When the branch ID starts with the JIRA ISSUE ID.</span>
<span class="c1"># It can be overridden if specified in the message.</span>
<span class="c1">#</span>
<span class="c1"># Example:</span>
<span class="c1">#</span>
<span class="c1"># jira-123/branch-name =&gt; 'JIRA-123 commit message'</span>
<span class="c1">#</span>

<span class="c1"># The name of the commit file is the first argument</span>
<span class="n">message_filename</span> <span class="o">=</span> <span class="no">ARGV</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1">#puts filename: message_filename</span>

<span class="c1"># Read the contents of the commit file</span>
<span class="n">message</span> <span class="o">=</span> <span class="no">File</span><span class="p">.</span><span class="nf">read</span><span class="p">(</span><span class="n">message_filename</span><span class="p">)</span>
<span class="c1">#puts message: message</span>

<span class="c1"># Match a JIRA ID in the commit message that</span>
<span class="n">jira_pattern</span> <span class="o">=</span> <span class="sr">/^([A-Z]{1,32}-[0-9]{1,32})\s/</span>

<span class="c1"># Capture the JIRA ID if one is present in the commit message</span>
<span class="n">jira_id</span> <span class="o">=</span> <span class="n">message</span><span class="p">[</span><span class="n">jira_pattern</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="c1">#puts jira_id: jira_id</span>

<span class="c1"># Do nothing if the commit message has a JIRA ID</span>
<span class="k">if</span> <span class="n">jira_id</span><span class="p">.</span><span class="nf">nil?</span>
  <span class="c1"># Otherwise we need to add one to the message</span>

  <span class="c1"># Grab the current git branch</span>
  <span class="n">current_branch_name</span> <span class="o">=</span> <span class="sb">`git rev-parse --abbrev-ref HEAD`</span>

  <span class="nb">exit</span> <span class="k">if</span> <span class="n">current_branch_name</span><span class="p">[</span><span class="sr">/^(master|develop|release|hotfix)/</span><span class="p">]</span>

  <span class="c1"># Match the JIRA ID at the beginning of the branch name</span>
  <span class="n">jira_branch_pattern</span> <span class="o">=</span> <span class="sr">/^([a-zA-Z]{1,32}-[0-9]{1,32})[-_\/]?/</span>

  <span class="c1"># Capture the JIRA ID from the branch name</span>
  <span class="n">jira_branch_id</span> <span class="o">=</span> <span class="n">current_branch_name</span><span class="p">[</span><span class="n">jira_branch_pattern</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
  <span class="c1">#puts jira_branch_id: jira_branch_id</span>

  <span class="k">if</span> <span class="n">jira_branch_id</span><span class="p">.</span><span class="nf">nil?</span> <span class="o">||</span> <span class="n">jira_branch_id</span><span class="p">.</span><span class="nf">empty?</span>
    <span class="c1"># Blow up and let the user know they're missing a JIRA ID</span>
    <span class="k">raise</span> <span class="s2">"Commit message missing JIRA ID and/or branch name does not have one"</span>
  <span class="k">else</span>
    <span class="c1"># Append a link to the JIRA issue and the JIRA ID to the message</span>
    <span class="n">jira_url</span> <span class="o">=</span> <span class="s2">"https://jira.walmart.com/browse/</span><span class="si">#{</span><span class="n">jira_branch_id</span><span class="si">}</span><span class="s2">"</span>
    <span class="n">new_message</span> <span class="o">=</span> <span class="s2">"</span><span class="si">#{</span><span class="n">jira_branch_id</span><span class="p">.</span><span class="nf">upcase</span><span class="si">}</span><span class="s2"> - </span><span class="si">#{</span><span class="n">message</span><span class="si">}</span><span class="se">\n</span><span class="si">#{</span><span class="n">jira_url</span><span class="si">}</span><span class="se">\n</span><span class="s2">"</span>
    <span class="c1">#puts new_message: message</span>

    <span class="c1"># Write the updated message back to the commit file</span>
    <span class="no">File</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="n">message_filename</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="p">{</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="n">f</span><span class="p">.</span><span class="nf">write</span><span class="p">(</span><span class="n">new_message</span><span class="p">)</span> <span class="p">}</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre></div></div>

			<footer>
				<div class="blocked tags">
					<p>
					
						<a href="/blog/tags/git">Git</a> |
					
					</p>
				</div>
			</footer>
			
			<br/>
		
			
			
			<div class="hr"></div>

		


			<!-- Discus Comments -->
			<div id="disqus_thread"></div>

			
			<!-- Enable Disqus comments -->
			<script type="text/javascript">
  var disqus_developer = 0; // developer mode is on
  var disqus_shortname = 'madhur';
  var disqus_identifier = '/2020/01/12/git-prepare-commit-message-jira-id/';
  var disqus_title = 'Ensuring git commit messages contain JIRA ID';
  var disqus_url = 'https://madhur.co.in/blog/2020/01/12/git-prepare-commit-message-jira-id.html';
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();

</script>

			
			
			
			

		</article>

		<div class="c">&nbsp;</div>

	</div>

	
</section>
 
<div class="c">&nbsp;</div>


  

 

 



        </div>


        <footer id="footer" class="row">

            <p id="copyright">
                &copy; 2011-2020 Madhur Ahuja
            </p>
            <p id="poweredby" class="visible-lg visible-md">
                Powered by
                <a href="http://jekyllrb.com" title="A static, minimalist CMS">Jekyll</a>,
                <a href="http://github.com/">Github</a> and
                <a href="http://disqus.com">Disqus</a>.
            </p>

            <div class="c">&nbsp;</div>


        </footer>


    </div>

    <script data-main="/files/js/app" src="/files/js/require.js"></script>  <script type="text/javascript">
	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-23769089-1']);
	  _gaq.push(['_trackPageview']);

	  (function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();

	</script> 

    <!-- serviceWorker.html -->
    <script>
        if ('serviceWorker' in navigator) {

            navigator.serviceWorker.getRegistrations().then(function (registrations) {
                for (let registration of registrations) {
                    registration.unregister()
                }
            })
        }

// if ('serviceWorker' in navigator) {
//     navigator.serviceWorker.register('/serviceWorker.js').then(function(reg) {
//         if (!reg.installing) return;
//         console.log("[*] ServiceWorker is installing...");

//         var worker = reg.installing;
//         worker.addEventListener('statechange', function() {
//             if (worker.state == 'redundant') {
//                 console.log('[*] Install failed');
//             }
//             if (worker.state == 'installed') {
//                 console.log('[*] Install successful!');
//             }
//         });
//     });
// }

    </script>

</body>

</html>