<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8" /> 
    <title>Estimate no. of kafka partitions handled by a single thread on compute &#8211; Madhur Ahuja</title>
    

    <meta name="author" content="Madhur Ahuja" />
    <meta name="description" content=" Estimate no. of kafka partitions handled by a single thread on compute" />

    <link rel="start" href="/" />

    <link rel="alternate" type="application/atom+xml" href="http://feeds.feedburner.com/madhur" title="RSS feed" />
    <link rel="shortcut icon" href="http://www.gravatar.com/avatar/5352cde0b084abcd6d4d783c08a51c76?s=16" />

    <link rel="stylesheet" href="/files/css/bootstrap.min.css" type="text/css" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="/files/font-awesome/css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="/files/css/jquery.fancybox.css" type="text/css" />

    <link rel="stylesheet" type="text/css" href="/files/css/styles.css" /> 
    <link rel="stylesheet" type="text/css" href="/files/css/syntax.css" /> 

     <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-N14VDHYFHQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-N14VDHYFHQ');
</script> 
    <link rel="stylesheet" type="text/css" media="print" href="/files/css/print.css"> 

    <script src="/files/js/vendor/pace.min.js" type="text/javascript"></script>
</head>


<body>

    <div class="container">

        <header id="header" class="row">

            <nav id="navigation" class="navbar navbar-inverse navbar-fixed-top " role="navigation">
    <div class="container">

    <div class="navbar-header">

     <div class="hidden-md hidden-sm hidden-lg searchli">

                <form method="get" role="search" id="searchform" action="/results" onsubmit="return checkfrm_search();">

                    <div class="form-group">
                        <input type="search" required id="q2" name="q" value="" class="form-control mobile" placeholder="Search" />
                    </div>
                </form>
        </div>

        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#mainmenu">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <!--  <a class="navbar-brand " href="/">Home</a> -->
    </div>

    <div class="collapse navbar-collapse" id="mainmenu">
        <ul id="nav" class="nav navbar-nav">
            
            <li><a class="home" href="/">Home</a>
            </li>
            <li><a class="blog" href="/blog">Blog</a>
            </li>
            <!--<li><a class="work" href="/work">Resume</a></li>-->
            <li><a class="code" href="/projects">Work</a>
            </li>
            <!--<li><a class="papers" href="/papers">Papers</a></li>-->
            <li><a class="info" href="/info">About</a>
            </li>
            <li><a class="contact" href="/contact">Contact</a>
            </li>

        </ul>

        <ul class="nav navbar-nav visible-md visible-lg visible-sm searchbox">
            <li>
                <form method="get" role="search" id="searchform" action="/results" onsubmit="return checkfrm_search();">

                    <div class="form-group">
                        <input type="search" required id="q1" name="q" value="" class="form-control desktop" placeholder="Search" />
                    </div>
                </form>
            </li>
        </ul>


        <ul class="nav-icons navbar-right nav navbar-nav visible-md visible-lg">
            <li><a href="http://www.linkedin.com/in/madhurahuja"><i class="fa fa-linkedin-square fa-3x"></i></a>
            </li>
            <li><a href="https://github.com/madhur"><i class="fa fa-github fa-3x"></i></a>
            </li>
            <li><a href="http://feeds.feedburner.com/madhur"><i class="fa fa-rss-square fa-3x"></i></a>
            </li>
        </ul>


    </div>

</div>
</nav>


        </header>

        <div id="content" class="row">

            <section>

	<div id="blogcontent">

		<!--<aside class="postmeta col-md-3 hidden-print visible-md visible-lg">

			

		</aside>-->

		<article id="blog-article" class="post col-md-12 clearfix">

				<header><h1>Estimate no. of kafka partitions handled by a single thread on compute</h1></header>
			
					<!-- Place this tag where you want the +1 button to render -->
<div class="row social hidden-xs">
    <div class="col-md-2 col-sm-2">
        <time datetime="2020-09-06 00:00:00 +0530" pubdate="pubdate"
            >06 September 2020</time
        >
    </div>
    <div class="social-icon col-md-2 col-sm-2">
       <a href="https://twitter.com/madhur25?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-show-count="false">Follow @madhur25</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    </div>
    <div class="social-icon col-md-1 col-sm-2">
        <a
            href="https://twitter.com/share?ref_src=twsrc%5Etfw"
            class="twitter-share-button"
            data-via="madhur25"
            data-show-count="false"
            >Tweet</a
        >
        <script
            async
            src="https://platform.twitter.com/widgets.js"
            charset="utf-8"
        ></script>
    </div>
    <div class="social-icon col-md-1 col-sm-2">
        <script src="https://platform.linkedin.com/in.js" type="text/javascript">lang: en_US</script>
        <script type="IN/Share" data-counter="right"></script>
    </div>

    <!-- <div class="social-icon col-md-1 col-sm-2">
        <a
            href="http://bufferapp.com/add"
            class="buffer-add-button"
            data-count="horizontal"
            >Buffer</a
        >
        <script
            type="text/javascript"
            src="https://d389zggrogs7qo.cloudfront.net/js/button.js"
        ></script>
    </div> -->
    <div class="social-icon col-md-1 col-sm-2">
        <a
            data-pocket-label="pocket"
            data-pocket-count="horizontal"
            class="pocket-btn"
            data-lang="en"
        ></a>
        <script type="text/javascript">
            !(function (d, i) {
                if (!d.getElementById(i)) {
                    var j = d.createElement("script");
                    j.id = i;
                    j.src = "https://widgets.getpocket.com/v1/j/btn.js?v=1";
                    var w = d.getElementById(i);
                    d.body.appendChild(j);
                }
            })(document, "pocket-btn-js");
        </script>
    </div>
    <!-- <div class="social-icon col-md-2 col-sm-2">
        <script
            type="text/javascript"
            src="//www.redditstatic.com/button/button1.js"
        ></script>
    </div> -->
</div>


			<hr style="margin-top:0px" />


			 <p>In a complex multi data center Kafka deployments, it is also important to
estimate no. of partition each thread will be handling per compute. It is very
important parameter to tune. For example, if you are seeing high lag and less
CPU usage, it could be because a single thread is handling too much partitions
and it might be advisable to increase the no. of threads per compute.</p>

<p>Let me take a hypothetical example of ours.</p>

<p>We have an active-active kafka setup with a topic having 210 partitions.</p>

<p>There is concurrency of 2 per compute i.e. a single VM will be spawning 2
threads to connect to Kafka broker.</p>

<p>There is imbalance in no. of computes. There are 8 computes in DC 1 and
16 computes in DC2.</p>

<p>Thus in DC1, 8*2=16 threads consume 120 partitions. 120/16 = 7.5, which means
Kafka should be allocating 7-8 partitions per thread. When I look at my
distribution, here is what I discover:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>C1 - 8+8 = 16 partitions (8/thread)
C2 - 8+8 = 16
C3 - 8+7 = 15
C4 - 8+8 = 16
C5 - 7+7 = 14
C6 - 7+7 = 14
c7 - 8+7 = 15
C8 - 7+7 = 14
</code></pre></div></div>

<p>Similarly, in DC2, 16*2=32 threads consume 120 partitions. 120/32 = 3.5, means
Kafka allocates 3-4 partitions per thread on each compute.</p>

<p>Thus, computes in DC1 are doing a lot more work assuming equal distribution
across both DC’s.</p>

<p>It is very important to tune the Kafka settings for both the DC’s separately
since both are doing unequal amount of work.</p>

			<footer>
				<div class="blocked tags">
					<p>
					
						<a href="/blog/tags/kafka">Kafka</a> |
					
						<a href="/blog/tags/concurrency">Concurrency</a> |
					
						<a href="/blog/tags/multithreading">Multithreading</a> |
					
					</p>
				</div>
			</footer>
			
			<br/>
		
			
			
			<div class="hr"></div>

		


			<!-- Discus Comments -->
			<div id="disqus_thread"></div>

			
			<!-- Enable Disqus comments -->
			<script type="text/javascript">
  var disqus_developer = 0; // developer mode is on
  var disqus_shortname = 'madhur';
  var disqus_identifier = '/2020/09/06/estimate-partitions-single-thread-compute/';
  var disqus_title = 'Estimate no. of kafka partitions handled by a single thread on compute';
  var disqus_url = 'https://madhur.co.in/blog/2020/09/06/estimate-partitions-single-thread-compute.html';
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();

</script>

			
			
			
			

		</article>

		<div class="c">&nbsp;</div>

	</div>

	
</section>
 
<div class="c">&nbsp;</div>


  

 

 



        </div>


        <footer id="footer" class="row">

            <p id="copyright">
                &copy; 2011-2024 Madhur Ahuja
            </p>
            <p id="poweredby" class="visible-lg visible-md">
                Powered by
                <a href="http://jekyllrb.com" title="A static, minimalist CMS">Jekyll</a>,
                <a href="http://github.com/">Github</a> and
                <a href="http://disqus.com">Disqus</a>.
            </p>

            <div class="c">&nbsp;</div>


        </footer>


    </div>

    <script data-main="/files/js/app" src="/files/js/require.js"></script> 
    

    <!-- serviceWorker.html -->
    <script>
        if ('serviceWorker' in navigator) {

            navigator.serviceWorker.getRegistrations().then(function (registrations) {
                for (let registration of registrations) {
                    registration.unregister()
                }
            })
        }

// if ('serviceWorker' in navigator) {
//     navigator.serviceWorker.register('/serviceWorker.js').then(function(reg) {
//         if (!reg.installing) return;
//         console.log("[*] ServiceWorker is installing...");

//         var worker = reg.installing;
//         worker.addEventListener('statechange', function() {
//             if (worker.state == 'redundant') {
//                 console.log('[*] Install failed');
//             }
//             if (worker.state == 'installed') {
//                 console.log('[*] Install successful!');
//             }
//         });
//     });
// }

    </script>

</body>

</html>