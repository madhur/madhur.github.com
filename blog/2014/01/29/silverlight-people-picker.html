<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Writing Silverlight people picker control using SharePoint 2010 Client object model &#8211; Madhur Ahuja</title>
    <meta name="author" content="Madhur Ahuja" />
    <meta name="description" content=" Writing Silverlight people picker control using SharePoint 2010 Client object model" />

    <link rel="start" href="/" />

    <link rel="alternate" type="application/atom+xml" href="http://feeds.feedburner.com/madhur" title="RSS feed" />
    <link rel="shortcut icon" href="http://www.gravatar.com/avatar/5352cde0b084abcd6d4d783c08a51c76?s=16" />

    <link rel="stylesheet" href="/files/css/bootstrap.min.css" type="text/css" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="/files/font-awesome/css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="/files/css/jquery.fancybox.css" type="text/css" />

    <link rel="stylesheet" type="text/css" href="/files/css/styles.css" />
    
    <link rel="stylesheet" type="text/css" href="/files/css/syntax.css" />
    

    <link rel="stylesheet" type="text/css" media="print" href="/files/css/print.css">

     
   
    <script src="/files/js/vendor/pace.min.js" type="text/javascript"></script>
</head>

<body>


    <div class="container">
       
            <header id="header" class="row">

                <nav id="navigation" class="navbar navbar-inverse navbar-fixed-top " role="navigation">
    <div class="container">

    <div class="navbar-header">

     <div class="hidden-md hidden-sm hidden-lg searchli">

                <form method="get" role="search" id="searchform" action="/results" onsubmit="return checkfrm_search();">

                    <div class="form-group">
                        <input type="search" required id="q2" name="q" value="" class="form-control mobile" placeholder="Search" />
                    </div>
                </form>
        </div>

        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#mainmenu">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
        </button>
        <!--  <a class="navbar-brand " href="/">Home</a> -->
    </div>

    <div class="collapse navbar-collapse" id="mainmenu">
        <ul id="nav" class="nav navbar-nav">
            
            <li><a class="home" href="/">Home</a>
            </li>
            <li><a class="blog" href="/blog">Blog</a>
            </li>
            <!--<li><a class="work" href="/work">Resume</a></li>-->
            <li><a class="code" href="/projects">Projects</a>
            </li>
            <!--<li><a class="papers" href="/papers">Papers</a></li>-->
            <li><a class="info" href="/info">About</a>
            </li>
            <li><a class="contact" href="/contact">Contact</a>
            </li>

        </ul>

        <ul class="nav navbar-nav visible-md visible-lg visible-sm searchbox">
            <li>
                <form method="get" role="search" id="searchform" action="/results" onsubmit="return checkfrm_search();">

                    <div class="form-group">
                        <input type="search" required id="q1" name="q" value="" class="form-control desktop" placeholder="Search" />
                    </div>
                </form>
            </li>
        </ul>


        <ul class="nav-icons navbar-right nav navbar-nav visible-md visible-lg">
            <li><a href="http://www.linkedin.com/in/madhurahuja"><i class="fa fa-linkedin-square fa-3x"></i></a>
            </li>
            <li><a href="https://github.com/madhur"><i class="fa fa-github fa-3x"></i></a>
            </li>
            <li><a href="http://feeds.feedburner.com/madhur"><i class="fa fa-rss-square fa-3x"></i></a>
            </li>
        </ul>


    </div>

</div>
</nav>


            </header>
       
        <div id="content" class="row">

            <section>

	<div id="blogcontent">

		<aside class="postmeta col-md-3 hidden-print visible-md visible-lg">

			<div class="timestamp">
	<time datetime="2014-01-29 00:00:00 +0530" pubdate="pubdate">29 January 2014</time>

	<br>
	
</div> 

<div class="actions">
<ul> 
								<li><a href="/blog/2014/01/29/silverlight-people-picker.html#disqus_thread" data-disqus-identifier="/2014/01/29/silverlight-people-picker/" class="comment">View Comments</a></li> 

<script type="text/javascript">

	var disqus_developer = 0;
		var disqus_shortname = 'madhur';
		var disqus_iframe_css = "http://madhur.github.com/css/screen.css";
			var links = document.getElementsByTagName('a');
			var query = '?';
			
					query += 'url=' + encodeURIComponent(window.location.href) + '&';
					//alert(query);
				
			
	document.write('<script type="text/javascript" src="http://disqus.com/forums/madhur/get_num_replies.js?url2=' + encodeURIComponent(window.location.url) + '#disqus_thread"></' + 'script>');
	

</script>


						
								<li><a href="http://feeds.feedburner.com/madhur" class="subscribe">subscribe to this blog</a></li> 
								
								<li><a href="javascript:Clickheretoprint()" class="subscribe">print this page</a></li> 								
								<li><a href="/blog/2014/01/29/silverlight-people-picker.html" class="permalink">permalink</a></li> 
															</ul> 

</div>


<div class="category">

	
	<div style="text-align:center">
	<!-- Enable social features -->
				<!-- Place this tag where you want the +1 button to render -->
<div class="social">
	
<div class="social-icon">
<div class="g-plusone" data-size="tall"></div>
</div>

<div class="social-icon">
<a href="https://twitter.com/share?count=vertical" class="twitter-share-button" data-via="madhur25">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</div>

<div class="social-icon">
<script src="//platform.linkedin.com/in.js" type="text/javascript">
  lang: en_US
</script>
<script type="IN/Share" data-counter="top"></script>
</div>

<!--
<div class="social-icon">
<script id='fbjtdqx'>(function(i){var f,s=document.getElementById(i);f=document.createElement('iframe');f.src='//api.flattr.com/button/view/?uid=madhur_ahuja&url='+encodeURIComponent(document.URL);f.title='Flattr';f.height=62;f.width=55;f.style.borderWidth=0;s.parentNode.insertBefore(f,s);})('fbjtdqx');</script>

</div>
-->


<div class="social-icon">
<a href="http://bufferapp.com/add" class="buffer-add-button" data-count="vertical" >Buffer</a><script type="text/javascript" src="https://d389zggrogs7qo.cloudfront.net/js/button.js"></script>
</div>

<div class="social-icon">
<a data-pocket-label="pocket" data-pocket-count="vertical" class="pocket-btn" data-lang="en"></a>
<script type="text/javascript">!function(d,i){if(!d.getElementById(i)){var j=d.createElement("script");j.id=i;j.src="https://widgets.getpocket.com/v1/j/btn.js?v=1";var w=d.getElementById(i);d.body.appendChild(j);}}(document,"pocket-btn-js");</script>
</div>


</div>





<!-- Place this tag after the last plusone tag -->
<!-- Place this tag after the last +1 button tag. -->
<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/platform.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>

	</div>

</div>





		</aside>

		<article id="blog-article" class="post col-md-9 clearfix">
					<header><h1>Writing Silverlight people picker control using SharePoint 2010 Client object model</h1></header>
			 <p>Whenever you are developing a silverlight solution on SharePoint 2010, one of the basic functionality you will require is the ability to select people from your Active Directory.</p>

<p>Sadly, I could not find a ready made custom silverlight control which I could utilize for my solution. I decided to write on my own. Rather than writing from scratch, I decided to
use the boilerplate code <a href="http://blogs.technet.com/b/speschka/archive/2011/08/09/writing-a-sharepoint-2010-people-picker-control-for-silverlight.aspx">provided</a> by Steve.</p>

<p>In this post, I am going to deep dive how I built this control.</p>

<p>My solution consists of two controls, <code>PeopleChooser</code> and <code>PeoplePicker</code>. <code>PeopleChooser</code> is a user control which is configured to either single select or multi select depending upon the 
configuration.  Hereâ€™s a screenshot of my people Chooser control, implemented as a user control in Silverlight.</p>

<p><img src="/images/Blog/singlepicker.png" alt="PeopleChooser Single Selection"></p>

<p>In case of multiple results, user can right click on the textbox to display multiple results and select one of them.</p>

<p><img src="/images/Blog/pickermultipleresults.png" alt="PeopleChooser Multiple results"></p>

<p>The multi select configuraiton is rendered as a listbox instead of a textbox. I made a conscious design decision to do this so that user instantly comes to know that this is a multi select
picker by directly looking at it. </p>

<p><img src="/images/Blog/multiplepicker.png" alt="PeopleChooser Multiple selection"></p>

<p><code>PeoplePicker</code> is a <code>ChildWindow</code> which is launched from the <code>PeopleChooser</code> to search and enumerate people from the active directory. 
Clicking on the address book button opens the people picker, where the user can select either multiple people or single people depending upon the configuration of the control.
This is the screenshot of  people picker control. </p>

<p><img src="/images/Blog/peoplepicker.png" alt="PeoplePicker"></p>

<p>Feel free to <a href="https://github.com/madhur/SLControls/archive/master.zip">download</a> this control or customize by downloding the source from my <a href="https://github.com/madhur/SLControls">github repo</a></p>

<p>Anyone, who wants to reuse or customize this control further, I will explain in brief how this works. </p>

<p>Both <code>PeopleChooser</code> and <code>PeoplePicker</code> have a listbox which employ two-way data binding.
Both listbox are bound to a following data structure <code>SelectedAccounts</code> which is an <code>ObservableCollection</code> of type <code>AccountList</code></p>

<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="k">public</span> <span class="k">class</span> <span class="nc">SelectedAccounts</span> <span class="p">:</span> <span class="n">ObservableCollection</span><span class="p">&lt;</span><span class="n">AccountList</span><span class="p">&gt;</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="nf">SelectedAccounts</span><span class="p">():</span> <span class="k">base</span><span class="p">()</span>
    <span class="p">{</span>         
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">public</span> <span class="k">class</span> <span class="nc">AccountList</span> <span class="p">:</span> <span class="n">INotifyPropertyChanged</span>
<span class="p">{</span>
    <span class="k">private</span> <span class="kt">string</span> <span class="n">_accountName</span><span class="p">;</span>
    <span class="k">private</span> <span class="kt">string</span> <span class="n">_displayName</span><span class="p">;</span>       
<span class="p">}</span></code></pre></div>

<p>The below XAML shows the two way databinding with this data structure</p>

<div class="highlight"><pre><code class="language-xml" data-lang="xml"><span class="nt">&lt;ListBox</span> <span class="na">x:Name=</span><span class="s">&quot;UsersListBox&quot;</span> <span class="na">DataContext=</span><span class="s">&quot;selectedAccounts&quot;</span> <span class="na">ItemsSource=</span><span class="s">&quot;{Binding SelectedAccounts, Mode=TwoWay}&quot;</span> <span class="na">HorizontalAlignment=</span><span class="s">&quot;Left&quot;</span> <span class="na">Height=</span><span class="s">&quot;100&quot;</span> <span class="na">Margin=</span><span class="s">&quot;26,43,0,0&quot;</span> <span class="na">VerticalAlignment=</span><span class="s">&quot;Top&quot;</span> <span class="na">Width=</span><span class="s">&quot;182&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;ListBox.RenderTransform&gt;</span>
        <span class="nt">&lt;CompositeTransform</span> <span class="na">SkewX=</span><span class="s">&quot;0.661&quot;</span> <span class="na">TranslateX=</span><span class="s">&quot;0.606&quot;</span><span class="nt">/&gt;</span>
    <span class="nt">&lt;/ListBox.RenderTransform&gt;</span>
    <span class="nt">&lt;ListBox.ItemTemplate&gt;</span>
        <span class="nt">&lt;DataTemplate&gt;</span>
            <span class="nt">&lt;StackPanel</span> <span class="na">Orientation=</span><span class="s">&quot;Horizontal&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;TextBlock</span> <span class="na">Text=</span><span class="s">&quot;{Binding DisplayName}&quot;</span><span class="nt">/&gt;</span>
            <span class="nt">&lt;/StackPanel&gt;</span>
        <span class="nt">&lt;/DataTemplate&gt;</span>
    <span class="nt">&lt;/ListBox.ItemTemplate&gt;</span>
<span class="nt">&lt;/ListBox&gt;</span></code></pre></div>

<p><code>SelectedAccounts</code> data structure is populated using People WebService.</p>

<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="n">PeopleSoapClient</span> <span class="n">ps</span> <span class="p">=</span> <span class="k">new</span> <span class="n">PeopleSoapClient</span><span class="p">();</span>
<span class="n">ps</span><span class="p">.</span><span class="n">Endpoint</span><span class="p">.</span><span class="n">Address</span> <span class="p">=</span>
<span class="k">new</span> <span class="n">System</span><span class="p">.</span><span class="n">ServiceModel</span><span class="p">.</span><span class="n">EndpointAddress</span><span class="p">(</span><span class="n">siteUrl</span> <span class="p">+</span> <span class="n">peopleWsUrl</span><span class="p">);</span>

<span class="n">ps</span><span class="p">.</span><span class="n">SearchPrincipalsCompleted</span> <span class="p">+=</span> <span class="k">new</span> <span class="n">EventHandler</span><span class="p">&lt;</span><span class="n">SearchPrincipalsCompletedEventArgs</span><span class="p">&gt;(</span><span class="n">ps_SearchPrincipalsCompleted</span><span class="p">);</span>

<span class="n">ps</span><span class="p">.</span><span class="n">SearchPrincipalsAsync</span><span class="p">(</span><span class="n">SearchTxt</span><span class="p">.</span><span class="n">Text</span><span class="p">,</span> <span class="m">50</span><span class="p">,</span> <span class="n">SPPrincipalType</span><span class="p">.</span><span class="n">User</span><span class="p">);</span></code></pre></div>

<p>Depending upon if multiple selection is allowed or not, <code>ListBox</code> is hidden and <code>TextBox</code> is shown instead along with a resolve button.</p>

<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="k">public</span> <span class="kt">bool</span> <span class="n">AllowMultiple</span> <span class="p">{</span> <span class="k">get</span><span class="p">;</span> <span class="k">set</span><span class="p">;</span> <span class="p">}</span>

<span class="k">void</span> <span class="nf">PeopleChooser_Loaded</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">RoutedEventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">AllowMultiple</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">UsersListBox</span><span class="p">.</span><span class="n">Visibility</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">Windows</span><span class="p">.</span><span class="n">Visibility</span><span class="p">.</span><span class="n">Visible</span><span class="p">;</span>
        <span class="n">UserTextBox</span><span class="p">.</span><span class="n">Visibility</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">Windows</span><span class="p">.</span><span class="n">Visibility</span><span class="p">.</span><span class="n">Collapsed</span><span class="p">;</span>
        <span class="n">ResolveButton</span><span class="p">.</span><span class="n">Visibility</span> <span class="p">=</span> <span class="n">Visibility</span><span class="p">.</span><span class="n">Collapsed</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">UsersListBox</span><span class="p">.</span><span class="n">Visibility</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">Windows</span><span class="p">.</span><span class="n">Visibility</span><span class="p">.</span><span class="n">Collapsed</span><span class="p">;</span>
        <span class="n">UserTextBox</span><span class="p">.</span><span class="n">Visibility</span> <span class="p">=</span> <span class="n">System</span><span class="p">.</span><span class="n">Windows</span><span class="p">.</span><span class="n">Visibility</span><span class="p">.</span><span class="n">Visible</span><span class="p">;</span>
        <span class="n">ResolveButton</span><span class="p">.</span><span class="n">Visibility</span> <span class="p">=</span> <span class="n">Visibility</span><span class="p">.</span><span class="n">Visible</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">peoplePicker</span><span class="p">.</span><span class="n">AllowMultiple</span> <span class="p">=</span> <span class="n">AllowMultiple</span><span class="p">;</span>

<span class="p">}</span></code></pre></div>

<p>If there are muliple results, right mouse button on <code>TextBox</code> is handled and displays choices to user to enable him to select a single result.</p>

<div class="highlight"><pre><code class="language-c#" data-lang="c#"><span class="k">private</span> <span class="k">void</span> <span class="nf">UserTextBox_MouseRightButtonUp</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">MouseButtonEventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Display a menu on mouse right button up</span>
    <span class="n">cMenu</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ContextMenu</span><span class="p">();</span>
    
    <span class="k">foreach</span> <span class="p">(</span><span class="n">PickerEntry</span> <span class="n">pi</span> <span class="k">in</span> <span class="n">values</span><span class="p">.</span><span class="n">Values</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">mnuItem</span> <span class="p">=</span> <span class="k">new</span> <span class="n">MenuItem</span><span class="p">();</span>
        <span class="n">mnuItem</span><span class="p">.</span><span class="n">Header</span> <span class="p">=</span> <span class="n">pi</span><span class="p">.</span><span class="n">DisplayName</span><span class="p">;</span>
        <span class="n">mnuItem</span><span class="p">.</span><span class="n">Name</span> <span class="p">=</span> <span class="n">pi</span><span class="p">.</span><span class="n">AccountName</span><span class="p">;</span>
        <span class="n">mnuItem</span><span class="p">.</span><span class="n">Click</span> <span class="p">+=</span> <span class="n">mnuItem_Click</span><span class="p">;</span>
        <span class="n">cMenu</span><span class="p">.</span><span class="n">Items</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">mnuItem</span><span class="p">);</span>

    <span class="p">}</span>

    <span class="n">cMenu</span><span class="p">.</span><span class="n">IsOpen</span> <span class="p">=</span> <span class="k">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">void</span> <span class="nf">mnuItem_Click</span><span class="p">(</span><span class="kt">object</span> <span class="n">sender</span><span class="p">,</span> <span class="n">RoutedEventArgs</span> <span class="n">e</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">MenuItem</span> <span class="n">mnu</span> <span class="p">=</span> <span class="n">sender</span> <span class="k">as</span> <span class="n">MenuItem</span><span class="p">;</span>

    <span class="n">values</span> <span class="p">=</span> <span class="k">new</span> <span class="n">Dictionary</span><span class="p">&lt;</span><span class="kt">string</span><span class="p">,</span> <span class="n">PickerEntry</span><span class="p">&gt;();</span>
    <span class="n">values</span><span class="p">.</span><span class="n">Add</span><span class="p">(</span><span class="n">mnu</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="k">new</span> <span class="n">PickerEntry</span><span class="p">(</span><span class="n">mnu</span><span class="p">.</span><span class="n">Header</span><span class="p">.</span><span class="n">ToString</span><span class="p">(),</span> <span class="n">mnu</span><span class="p">.</span><span class="n">Name</span><span class="p">,</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">,</span> <span class="kt">string</span><span class="p">.</span><span class="n">Empty</span><span class="p">));</span>

    <span class="n">SetSingleResult</span><span class="p">(</span><span class="n">values</span><span class="p">);</span>
<span class="p">}</span></code></pre></div>

			<footer>
				<div class="blocked tags">
					<p>
					
						<a href="/blog/tags/silverlight">Silverlight</a> |
					
						<a href="/blog/tags/sharepoint-2010">SharePoint 2010</a> |
					
					</p>
				</div>
			</footer>
			
			<br/>
		
			
			
			<div class="hr"></div>

		


			<!-- Discus Comments -->
			<div id="disqus_thread"></div>

			
			<!-- Enable Disqus comments -->
			<script type="text/javascript">
  var disqus_developer = 0; // developer mode is on
  var disqus_shortname = 'madhur';
  var disqus_identifier = '/2014/01/29/silverlight-people-picker/';
  var disqus_title = 'Writing Silverlight people picker control using SharePoint 2010 Client object model';
  var disqus_url = 'http://madhur.co.in/blog/2014/01/29/silverlight-people-picker.html';
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();

</script>

			
			
			
			

		</article>

		<div class="c">&nbsp;</div>

	</div>

	
</section>
 
<div class="c">&nbsp;</div>


  
<script type="text/javascript">
    
    var disqus_shortname = 'madhur'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>

 

 



        </div>


        <footer id="footer" class="row">

            <p id="copyright">
                &copy; 2011-2015 Madhur Ahuja
            </p>
            <p id="poweredby" class="visible-lg visible-md">
                Powered by
                <a href="http://jekyllrb.com" title="A static, minimalist CMS">Jekyll</a>, <a href="http://github.com/">Github</a> and <a href="http://disqus.com">Disqus</a>.
            </p>

            <div class="c">&nbsp;</div>


        </footer>


    </div>

    <script data-main="/files/js/app" src="/files/js/require.js"></script>

    
        <script type="text/javascript">
	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-23769089-1']);
	  _gaq.push(['_trackPageview']);

	  (function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();

	</script>
    

</body>

</html>
