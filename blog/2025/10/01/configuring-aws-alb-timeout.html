<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8" /> 
    <title>Configuring AWS ALB Timeouts &#8211; Madhur Ahuja</title>
    

    <meta name="author" content="Madhur Ahuja" />
    <meta name="description" content=" Configuring AWS ALB Timeouts" />

    <link rel="start" href="/" />

    <link rel="alternate" type="application/atom+xml" href="http://feeds.feedburner.com/madhur" title="RSS feed" />
    <link rel="shortcut icon" href="http://www.gravatar.com/avatar/5352cde0b084abcd6d4d783c08a51c76?s=16" />

    <link rel="stylesheet" href="/files/css/bootstrap.min.css" type="text/css" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="/files/font-awesome/css/font-awesome.min.css" type="text/css" />
    <script src="/files/js/vendor/fancybox.umd.js" tpye="text/javascript"></script>
    <link rel="stylesheet" href="/files/css/fancybox.css" type="text/css" />

    <link rel="stylesheet" type="text/css" href="/files/css/styles.css" /> 
    <link rel="stylesheet" type="text/css" href="/files/css/syntax.css" /> 

     <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-N14VDHYFHQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-N14VDHYFHQ');
</script> 
    <link rel="stylesheet" type="text/css" media="print" href="/files/css/print.css"> 

    <script src="/files/js/vendor/pace.min.js" type="text/javascript"></script>
</head>


<body>

    <div class="container">

        <header id="header" class="row">

            <nav id="navigation" class="navbar navbar-inverse navbar-fixed-top " role="navigation">
    <div class="container">

        <div class="navbar-header">

            <div class="hidden-md hidden-sm hidden-lg searchli">

                <form method="get" role="search" id="searchform" action="/results" onsubmit="return checkfrm_search();">

                    <div class="form-group">
                        <input type="search" required id="q2" name="q" value="" class="form-control mobile"
                            placeholder="Search" />
                    </div>
                </form>
            </div>

            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#mainmenu">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <!--  <a class="navbar-brand " href="/">Home</a> -->
        </div>

        <div class="collapse navbar-collapse" id="mainmenu">
            <ul id="nav" class="nav navbar-nav">

                <li><a class="home" href="/">Home</a>
                </li>
                <li><a class="blog" href="/blog">Blog</a>
                </li>
                <!--<li><a class="work" href="/work">Resume</a></li>-->
                <li><a class="code" href="/projects">Work</a>
                </li>
                <!--<li><a class="papers" href="/papers">Papers</a></li>-->
                <li><a class="info" href="/info">About</a>
                </li>
                <li><a class="contact" href="/contact">Contact</a>
                </li>

            </ul>

            <ul class="nav navbar-nav visible-md visible-lg visible-sm searchbox">
                <li>
                    <form method="get" role="search" id="searchform" action="/results"
                        onsubmit="return checkfrm_search();">

                        <div class="form-group">
                            <input type="search" required id="q1" name="q" value="" class="form-control desktop"
                                placeholder="Search" />
                        </div>
                    </form>
                </li>
            </ul>


            <ul class="nav-icons navbar-right nav navbar-nav visible-md visible-lg">
                <li><a href="http://www.linkedin.com/in/madhurahuja"><i class="fa fa-linkedin-square fa-3x"></i></a>
                </li>
                <li><a href="https://github.com/madhur"><i class="fa fa-github fa-3x"></i></a>
                </li>
                <li><a href="http://feeds.feedburner.com/madhur"><i class="fa fa-rss-square fa-3x"></i></a>
                </li>
            </ul>


        </div>

    </div>
</nav>

        </header>

        <div id="content" class="row">

            <section>

	<div id="blogcontent">


		<article id="blog-article" class="post col-md-12 clearfix">

			<header>
				<h1>Configuring AWS ALB Timeouts</h1>
			</header>

			<div class="row social hidden-xs">
    <div class="col-md-2 col-sm-2">
        <time datetime="2025-10-01 00:00:00 +0530" pubdate="pubdate"
            >01 October 2025</time
        >
    </div>
    <div class="social-icon col-md-2 col-sm-2">
       <a href="https://twitter.com/madhur25?ref_src=twsrc%5Etfw" class="twitter-follow-button" data-show-count="false">Follow @madhur25</a><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
    </div>
    <div class="social-icon col-md-1 col-sm-2">
        <a
            href="https://twitter.com/share?ref_src=twsrc%5Etfw"
            class="twitter-share-button"
            data-via="madhur25"
            data-show-count="false"
            >Tweet</a
        >
        <script
            async
            src="https://platform.twitter.com/widgets.js"
            charset="utf-8"
        ></script>
    </div>

    <div class="social-icon col-md-1 col-sm-2">
        <a
            data-pocket-label="pocket"
            data-pocket-count="horizontal"
            class="pocket-btn"
            data-lang="en"
        ></a>
        <script type="text/javascript">
            !(function (d, i) {
                if (!d.getElementById(i)) {
                    var j = d.createElement("script");
                    j.id = i;
                    j.src = "https://widgets.getpocket.com/v1/j/btn.js?v=1";
                    var w = d.getElementById(i);
                    d.body.appendChild(j);
                }
            })(document, "pocket-btn-js");
        </script>
    </div>
</div>


			<hr style="margin-top:0px" />


			<blockquote>
  <p><strong>Author’s Note:</strong> I recently encountered this exact library issue. After solving it, I used Claude AI to help me structure this troubleshooting guide based on my experience. The problem and solution are genuine - I just wanted to create a quick resource that others could benefit from.</p>
</blockquote>

<h3 id="alb-idle-timeout-configuration-best-practices-to-prevent-5xx-errors">ALB Idle Timeout Configuration: Best Practices to Prevent 5xx Errors</h3>

<p>If you’ve ever encountered mysterious 502 Bad Gateway or 504 Gateway Timeout errors from your AWS Application Load Balancer (ALB), you’re not alone. Many of these issues stem from improperly configured timeout settings between your ALB and backend applications. In this article, we’ll explore the best practices for configuring ALB idle timeouts.</p>

<h2 id="understanding-the-problem">Understanding the Problem</h2>

<p>AWS Application Load Balancers manage connections between clients and your backend applications. When timeout configurations are misaligned, you create race conditions that result in intermittent 5xx errors and degraded user experience.</p>

<p>The root cause typically involves two types of timeouts that must work in harmony:</p>
<ul>
  <li><strong>Request timeouts</strong>: How long to wait for a single request/response cycle</li>
  <li><strong>Keep-alive (idle) timeouts</strong>: How long to maintain connections between requests</li>
</ul>

<h2 id="request-timeout-best-practices">Request Timeout Best Practices</h2>

<h3 id="the-golden-rule-application-timeout--alb-timeout">The Golden Rule: Application Timeout &lt; ALB Timeout</h3>

<p>Your application’s request timeout should always be shorter than your ALB’s timeout. Here’s the recommended hierarchy:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ALB Request Timeout: 60 seconds (default)
Application Timeout: 50-55 seconds
Database/External API Timeout: 45 seconds or less
</code></pre></div></div>

<h3 id="why-this-matters">Why This Matters</h3>

<p>When your application timeout equals or exceeds the ALB timeout, you create a dangerous race condition:</p>

<ol>
  <li><strong>Request arrives</strong> at ALB and forwards to your application</li>
  <li><strong>Both timers start</strong> counting down simultaneously</li>
  <li><strong>Application timeout hits first</strong> and closes the connection</li>
  <li><strong>ALB is still waiting</strong> for a response when connection terminates</li>
  <li><strong>ALB generates 5xx error</strong> instead of receiving your application’s graceful error response</li>
</ol>

<h2 id="keep-alive-timeout-best-practices">Keep-Alive Timeout Best Practices</h2>

<h3 id="the-reverse-rule-application-keep-alive--alb-idle-timeout">The Reverse Rule: Application Keep-Alive &gt; ALB Idle Timeout</h3>

<p>Unlike request timeouts, keep-alive timeouts follow the opposite pattern:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ALB Idle Timeout: 60 seconds (default)
Application Keep-Alive: 65+ seconds
Database Connection Pool Idle: 70+ seconds
</code></pre></div></div>

<h3 id="why-application-keep-alive-should-be-higher">Why Application Keep-Alive Should Be Higher</h3>

<p>If your application’s keep-alive timeout is shorter than ALB’s idle timeout:</p>

<ol>
  <li><strong>Client completes request</strong> through ALB to application</li>
  <li><strong>Application closes connection</strong> after its shorter keep-alive period</li>
  <li><strong>ALB still considers connection active</strong> and attempts reuse</li>
  <li><strong>Next request fails</strong> with 502 Bad Gateway because connection is closed</li>
</ol>

<h2 id="advanced-configuration-scenarios">Advanced Configuration Scenarios</h2>

<h3 id="high-traffic-applications">High-Traffic Applications</h3>

<p>For applications handling high request volumes:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ALB Idle Timeout: 30 seconds (reduced)
Application Keep-Alive: 35 seconds
Request Timeout: 25 seconds
</code></pre></div></div>

<p>Shorter timeouts free up connections faster and improve resource utilization.</p>

<h3 id="long-running-operations">Long-Running Operations</h3>

<p>For applications with legitimate long-running operations:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ALB Request Timeout: 300 seconds (5 minutes)
Application Timeout: 280 seconds
Keep-Alive: 310 seconds
</code></pre></div></div>

<p>Consider moving truly long operations to asynchronous processing with status polling endpoints.</p>

<h3 id="microservices-architecture">Microservices Architecture</h3>

<p>For service-to-service communication:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>External ALB (Internet-facing):
  - Request Timeout: 60s
  - Idle Timeout: 60s

Internal ALB (Service-to-service):
  - Request Timeout: 30s
  - Idle Timeout: 30s

Application Configuration:
  - Request Timeout: 25s
  - Keep-Alive: 35s
</code></pre></div></div>

<h2 id="monitoring-and-troubleshooting">Monitoring and Troubleshooting</h2>

<h3 id="key-metrics-to-monitor">Key Metrics to Monitor</h3>

<p><strong>ALB CloudWatch Metrics</strong>:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">HTTPCode_ELB_5XX_Count</code>: Track 5xx errors from ALB</li>
  <li><code class="language-plaintext highlighter-rouge">TargetResponseTime</code>: Monitor backend response times</li>
  <li><code class="language-plaintext highlighter-rouge">ActiveConnectionCount</code>: Watch connection patterns</li>
</ul>

<p><strong>Application Metrics</strong>:</p>
<ul>
  <li>Connection pool utilization</li>
  <li>Request timeout occurrences</li>
  <li>Keep-alive connection reuse rates</li>
</ul>

<h3 id="common-error-patterns">Common Error Patterns</h3>

<p><strong>502 Bad Gateway</strong>:</p>
<ul>
  <li>Often indicates application closed connection unexpectedly</li>
  <li>Check: Application keep-alive &lt; ALB idle timeout</li>
  <li>Check: Application crashed or became unresponsive</li>
</ul>

<p><strong>504 Gateway Timeout</strong>:</p>
<ul>
  <li>ALB timeout expired waiting for response</li>
  <li>Check: Application timeout ≥ ALB request timeout</li>
  <li>Check: Long-running operations without proper timeout handling</li>
</ul>

<h3 id="debugging-commands">Debugging Commands</h3>

<p><strong>Test connection behavior</strong>:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Test keep-alive behavior</span>
curl <span class="nt">-H</span> <span class="s2">"Connection: keep-alive"</span> <span class="nt">-v</span> http://your-alb-endpoint/

<span class="c"># Monitor connection reuse</span>
curl <span class="nt">-H</span> <span class="s2">"Connection: keep-alive"</span> <span class="nt">-v</span> <span class="se">\</span>
  http://your-alb-endpoint/endpoint1 <span class="se">\</span>
  http://your-alb-endpoint/endpoint2
</code></pre></div></div>

<p><strong>Check ALB configuration</strong>:</p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>aws elbv2 describe-load-balancer-attributes <span class="se">\</span>
  <span class="nt">--load-balancer-arn</span> arn:aws:elasticloadbalancing:...
</code></pre></div></div>

<h2 id="best-practices-summary">Best Practices Summary</h2>

<ol>
  <li><strong>Request Timeouts</strong>: Application timeout should be 10-15% shorter than ALB timeout</li>
  <li><strong>Keep-Alive Timeouts</strong>: Application keep-alive should be 5-10 seconds longer than ALB idle timeout</li>
  <li><strong>Monitor Religiously</strong>: Set up alerts for 5xx error rates and connection metrics</li>
  <li><strong>Test Thoroughly</strong>: Use load testing tools to validate timeout behavior under various conditions</li>
  <li><strong>Document Configuration</strong>: Maintain clear documentation of timeout values across your infrastructure</li>
  <li><strong>Gradual Changes</strong>: Modify timeout values incrementally and monitor impact</li>
</ol>

<h2 id="conclusion">Conclusion</h2>

<p>Proper timeout configuration is crucial for maintaining reliable web applications behind AWS Application Load Balancers. By following the principles outlined in this guide—keeping application request timeouts shorter than ALB timeouts and application keep-alive timeouts longer than ALB idle timeouts—you can eliminate most timeout-related 5xx errors.</p>

<p>Remember that timeout configuration is not a one-size-fits-all solution. Consider your application’s specific requirements, traffic patterns, and operational constraints when implementing these best practices. Regular monitoring and testing will help you fine-tune these settings for optimal performance and reliability.</p>

<p>The investment in properly configuring these timeouts will pay dividends in improved user experience, reduced operational overhead, and fewer 3 AM troubleshooting sessions.</p>

			<footer>
				<div class="blocked tags">
					<p>
						
						<a href="/blog/tags/timeout">Timeout</a> |
						
					</p>
				</div>
			</footer>

			<br />



			<div class="hr"></div>




			<!-- Discus Comments -->
			<div id="disqus_thread"></div>

			
			<!-- Enable Disqus comments -->
			<script type="text/javascript">
  var disqus_developer = 0; // developer mode is on
  var disqus_shortname = 'madhur';
  var disqus_identifier = '/2025/10/01/configuring-aws-alb-timeout/';
  var disqus_title = 'Configuring AWS ALB Timeouts';
  var disqus_url = 'https://madhur.co.in/blog/2025/10/01/configuring-aws-alb-timeout.html';
  (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'https://' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();

</script>

			




		</article>

		<div class="c">&nbsp;</div>

	</div>


</section>

<div class="c">&nbsp;</div>

        </div>


        <footer id="footer" class="row">

            <p id="copyright">
                &copy; 2011-2025 Madhur Ahuja
            </p>
            <p id="poweredby" class="visible-lg visible-md">
                Powered by
                <a href="http://jekyllrb.com" title="A static, minimalist CMS">Jekyll</a>,
                <a href="http://github.com/">Github</a> and
                <a href="http://disqus.com">Disqus</a>.
            </p>

            <div class="c">&nbsp;</div>


        </footer>


    </div>

    <script data-main="/files/js/app" src="/files/js/require.js"></script> 
    

    <!-- serviceWorker.html -->
    <script>
        if ('serviceWorker' in navigator) {

            navigator.serviceWorker.getRegistrations().then(function (registrations) {
                for (let registration of registrations) {
                    registration.unregister()
                }
            })
        }

// if ('serviceWorker' in navigator) {
//     navigator.serviceWorker.register('/serviceWorker.js').then(function(reg) {
//         if (!reg.installing) return;
//         console.log("[*] ServiceWorker is installing...");

//         var worker = reg.installing;
//         worker.addEventListener('statechange', function() {
//             if (worker.state == 'redundant') {
//                 console.log('[*] Install failed');
//             }
//             if (worker.state == 'installed') {
//                 console.log('[*] Install successful!');
//             }
//         });
//     });
// }

    </script>

</body>

</html>