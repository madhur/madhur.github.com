<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8" /> 
    <title>Backup and Restore specific cassandra tables &#8211; Madhur Ahuja</title>
    

    <meta name="author" content="Madhur Ahuja" />
    <meta name="description" content=" Backup and Restore specific cassandra tables" />

    <link rel="start" href="/" />

    <link rel="alternate" type="application/atom+xml" href="http://feeds.feedburner.com/madhur" title="RSS feed" />
    <link rel="shortcut icon" href="http://www.gravatar.com/avatar/5352cde0b084abcd6d4d783c08a51c76?s=16" />

    <link rel="stylesheet" href="/files/css/bootstrap.min.css" type="text/css" />

    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="/files/font-awesome/css/font-awesome.min.css" type="text/css" />
    <script src="/files/js/vendor/fancybox.umd.js" tpye="text/javascript"></script>
    <link rel="stylesheet" href="/files/css/fancybox.css" type="text/css" />

    <link rel="stylesheet" type="text/css" href="/files/css/styles.css" /> 
    <link rel="stylesheet" type="text/css" href="/files/css/syntax.css" /> 

     <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-N14VDHYFHQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-N14VDHYFHQ');
</script> 
    <link rel="stylesheet" type="text/css" media="print" href="/files/css/print.css"> 

    <script src="/files/js/vendor/pace.min.js" type="text/javascript"></script>
</head>


<body>

    <div class="container">

        <header id="header" class="row">

            <nav id="navigation" class="navbar navbar-inverse navbar-fixed-top top-nav-collapse" role="navigation">
    <div class="container">

        <div class="navbar-header">

            <div class="hidden-md hidden-sm hidden-lg searchli">

                <form method="get" role="search" id="searchform" action="/results" onsubmit="return checkfrm_search();">

                    <div class="form-group">
                        <input type="search" required id="q2" name="q" value="" class="form-control mobile"
                            placeholder="Search" />
                    </div>
                </form>
            </div>

            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#mainmenu">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <!--  <a class="navbar-brand " href="/">Home</a> -->
        </div>

        <div class="collapse navbar-collapse" id="mainmenu">
            <ul id="nav" class="nav navbar-nav">

                <li><a class="home" href="/">Home</a>
                </li>
                <li><a class="blog" href="/blog">Blog</a>
                </li>
                <!--<li><a class="work" href="/work">Resume</a></li>-->
                <li><a class="code" href="/projects">Work</a>
                </li>
                <!--<li><a class="papers" href="/papers">Papers</a></li>-->
                <li><a class="info" href="/info">About</a>
                </li>
                <li><a class="contact" href="/contact">Contact</a>
                </li>

            </ul>

            <ul class="nav navbar-nav visible-md visible-lg visible-sm searchbox">
                <li>
                    <form method="get" role="search" id="searchform" action="/results"
                        onsubmit="return checkfrm_search();">

                        <div class="form-group">
                            <input type="search" required id="q1" name="q" value="" class="form-control desktop"
                                placeholder="Search" />
                        </div>
                    </form>
                </li>
            </ul>


            <ul class="nav-icons navbar-right nav navbar-nav visible-md visible-lg">
                <li><a href="http://www.linkedin.com/in/madhurahuja"><i class="fa fa-linkedin-square fa-3x"></i></a>
                </li>
                <li><a href="https://github.com/madhur"><i class="fa fa-github fa-3x"></i></a>
                </li>
                <li><a href="http://feeds.feedburner.com/madhur"><i class="fa fa-rss-square fa-3x"></i></a>
                </li>
            </ul>


        </div>

    </div>
</nav>

        </header>

        <div id="content" class="row">

            <section>

	<div id="blogcontent">


		<article id="blog-article" class="post col-md-12 clearfix">

			<header>
				<h1>Backup and Restore specific cassandra tables</h1>
			</header>

			



<div class="post-meta">
    <time datetime="2021-10-30T00:00:00+05:30">October 30, 2021</time>
    <span class="reading-time">1 min read</span>
</div>


			<hr style="margin-top:0px" />


			<p>Recently, we had to make alterations directly to production cassandra tables due to an urgent bug fix and required to backup and restore specific cassandra tables so that we could roll back incase something gone wrong.</p>

<p>Backup and restoring tables is seamless using <a href="https://cassandra.apache.org/doc/latest/cassandra/tools/nodetool/nodetool.html">nodetool</a> and <a href="https://cassandra.apache.org/doc/latest/cassandra/tools/sstable/sstableloader.html">sstableloader</a></p>

<h2 id="cassandra-table-backup-steps">Cassandra table backup steps</h2>

<ul>
  <li>Login to Casandra Box</li>
  <li>Execute the following commands from the cassandra bin directory</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   ./nodetool snapshot -cf &lt;tablename&gt; &lt;keyspace&gt;
</code></pre></div></div>

<ul>
  <li>
    <p>Repeat the same for any other table to be backed up</p>
  </li>
  <li>
    <p>This will create snapshots in the data directory at following locations:</p>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  cassandra/data/data/&lt;keyspace&gt;/&lt;table&gt;-&lt;UID&gt;/snapshots/&lt;epoch&gt;
</code></pre></div></div>

<h2 id="cassandra-table-restore-steps">Cassandra table restore steps</h2>

<ul>
  <li>Login to cassandra box</li>
  <li>Navigate to following folder</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  cassandra/data/data/f&lt;keyspace&gt;/&lt;table&gt;-&lt;UID&gt;
</code></pre></div></div>
<p>Execute following command</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  cp snapshots/&lt;epoch&gt;/*.* .
</code></pre></div></div>

<ul>
  <li>
    <p>Repeat the same for any other table to be restored</p>
  </li>
  <li>
    <p>Once all the snapshots have been copied to data directory, run following commands in sequence:</p>
  </li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  ./nodetool refresh &lt;keyspace&gt; &lt;table&gt;;
</code></pre></div></div>

			<footer>
				<div class="blocked tags">
					<p>
						
						<a href="/blog/tags/cassandra">Cassandra</a> |
						
					</p>
				</div>
			</footer>

			<br />



			<div class="hr"></div>

		</article>

		<div class="c">&nbsp;</div>

	</div>


</section>

<div class="c">&nbsp;</div>

        </div>


        <footer id="footer" class="row">

            <p id="copyright">
                &copy; 2011-2026 Madhur Ahuja
            </p>
            <p id="poweredby" class="visible-lg visible-md">
                Powered by <a href="http://jekyllrb.com">Jekyll</a> and <a href="http://github.com/">Github</a>.
            </p>

            <div class="c">&nbsp;</div>


        </footer>


    </div>

    <script src="/files/js/main.js"></script> 
    

    <!-- serviceWorker.html -->
    <script>
        if ('serviceWorker' in navigator) {

            navigator.serviceWorker.getRegistrations().then(function (registrations) {
                for (let registration of registrations) {
                    registration.unregister()
                }
            })
        }

// if ('serviceWorker' in navigator) {
//     navigator.serviceWorker.register('/serviceWorker.js').then(function(reg) {
//         if (!reg.installing) return;
//         console.log("[*] ServiceWorker is installing...");

//         var worker = reg.installing;
//         worker.addEventListener('statechange', function() {
//             if (worker.state == 'redundant') {
//                 console.log('[*] Install failed');
//             }
//             if (worker.state == 'installed') {
//                 console.log('[*] Install successful!');
//             }
//         });
//     });
// }

    </script>

</body>

</html>